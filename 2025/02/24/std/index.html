

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/title.jpg">
  <link rel="icon" href="/img/title.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="雨沫">
  <meta name="keywords" content="">
  
    <meta name="description" content="0227A 123456789101112131415161718#include&lt;iostream&gt;#define int long longusing namespace std;int n,a[5010],ans,b[2000010];signed main()&#123;	ios::sync_with_stdio(0);	cin.tie(0);cout.tie(0);	cin&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="标程">
<meta property="og:url" content="https://yumomeow.github.io/2025/02/24/std/index.html">
<meta property="og:site_name" content="雨沫喵~">
<meta property="og:description" content="0227A 123456789101112131415161718#include&lt;iostream&gt;#define int long longusing namespace std;int n,a[5010],ans,b[2000010];signed main()&#123;	ios::sync_with_stdio(0);	cin.tie(0);cout.tie(0);	cin&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-02-24T12:20:00.000Z">
<meta property="article:modified_time" content="2025-03-12T12:25:59.899Z">
<meta property="article:author" content="雨沫">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>标程 - 雨沫喵~</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css">
<link rel="stylesheet" href="/css/cloudedGlass.css">
<link rel="stylesheet" href="/css/color.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yumomeow.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body><!-- hexo injector body_begin start --><div id="web_bg"></div><!-- hexo injector body_begin end -->
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>雨沫</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="标程"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-24 20:20" pubdate>
          2025年2月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          146 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">标程</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="0227A">0227A</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">int</span> n,a[<span class="hljs-number">5010</span>],ans,b[<span class="hljs-number">2000010</span>];<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;a[i];<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=i<span class="hljs-number">+1</span>;j&lt;=n;j++)&#123;<br>			ans+=b[a[i]^a[j]];<span class="hljs-comment">//先算后面的</span><br>		&#125;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;i;j++) b[a[i]^a[j]]++;<span class="hljs-comment">//再加前面的</span><br>	&#125;<br>	cout&lt;&lt;ans;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="0227B">0227B</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pii pair<span class="hljs-string">&lt;int,int&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">5e6</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,s,t,tot,p,head[N],dis[N];<br><span class="hljs-type">bool</span> vis[N];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">hsh</span><span class="hljs-params">(pii a)</span></span>&#123;<span class="hljs-keyword">return</span> a.first+a.second*n;&#125;<span class="hljs-comment">//映射</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;pii to;<span class="hljs-type">int</span> w,nxt;<span class="hljs-type">bool</span> fl;&#125;e[N];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addedge</span><span class="hljs-params">(pii u,pii v,<span class="hljs-type">int</span> w,<span class="hljs-type">bool</span> fl)</span></span>&#123;<br>	e[++tot].nxt=head[<span class="hljs-built_in">hsh</span>(u)];<br>	e[tot].to=v;<br>	e[tot].w=w;e[tot].fl=fl;<br>	head[<span class="hljs-built_in">hsh</span>(u)]=tot;<br>&#125;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	pii u;<span class="hljs-type">int</span> dis;<br>	<span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Node &amp;t) <span class="hljs-type">const</span>&#123;<br>		<span class="hljs-keyword">return</span> dis&gt;t.dis;<br>	&#125;<br>&#125;;<br>priority_queue&lt;Node&gt; q;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m&gt;&gt;s&gt;&gt;t;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>,a,b,d;i&lt;=m;i++)&#123;<br>		<span class="hljs-type">char</span> ch;<br>		cin&gt;&gt;a&gt;&gt;b&gt;&gt;d&gt;&gt;ch;<br>		<span class="hljs-built_in">addedge</span>(&#123;a,<span class="hljs-number">0</span>&#125;,&#123;b,<span class="hljs-number">0</span>&#125;,d,ch==<span class="hljs-string">&#x27;G&#x27;</span>?<span class="hljs-number">1</span>:<span class="hljs-number">0</span>);<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">20</span>;i++)&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=n;j++)&#123;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=head[<span class="hljs-built_in">hsh</span>(&#123;j,<span class="hljs-number">0</span>&#125;)];k;k=e[k].nxt)&#123;<br>				<span class="hljs-keyword">if</span>(e[k].fl) <span class="hljs-built_in">addedge</span>(&#123;j,i&#125;,&#123;e[k].to.first,i&#125;,(<span class="hljs-type">int</span>)<span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.0</span>*e[k].w/<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,i)),<span class="hljs-number">1</span>);<span class="hljs-comment">//平整</span><br>				<span class="hljs-keyword">else</span> <span class="hljs-built_in">addedge</span>(&#123;j,i&#125;,&#123;e[k].to.first,<span class="hljs-number">0</span>&#125;,(<span class="hljs-type">int</span>)<span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.0</span>*e[k].w/<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,i)),<span class="hljs-number">1</span>);<span class="hljs-comment">//坑</span><br>			&#125;<br>		&#125;<br>	&#125;<br>	cin&gt;&gt;p;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>,x,c;i&lt;=p;i++)&#123;<br>		cin&gt;&gt;x&gt;&gt;c;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=<span class="hljs-number">20</span>;j++) <span class="hljs-built_in">addedge</span>(&#123;x,j<span class="hljs-number">-1</span>&#125;,&#123;x,j&#125;,c,<span class="hljs-number">1</span>);<span class="hljs-comment">//修理站建边</span><br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;=<span class="hljs-number">20</span>;j++) dis[<span class="hljs-built_in">hsh</span>(&#123;i,j&#125;)]=<span class="hljs-number">0x3f3f3f3f</span>;<br>	&#125;<br>	dis[<span class="hljs-built_in">hsh</span>(&#123;s,<span class="hljs-number">0</span>&#125;)]=<span class="hljs-number">0</span>;<br>	q.<span class="hljs-built_in">push</span>(&#123;&#123;s,<span class="hljs-number">0</span>&#125;,<span class="hljs-number">0</span>&#125;);<br>	<span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>		<span class="hljs-type">int</span> u=<span class="hljs-built_in">hsh</span>(q.<span class="hljs-built_in">top</span>().u);<br>		q.<span class="hljs-built_in">pop</span>();<br>		<span class="hljs-keyword">if</span>(vis[u]) <span class="hljs-keyword">continue</span>;<br>		vis[u]=<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>			pii v=e[i].to;<br>			<span class="hljs-keyword">if</span>(dis[<span class="hljs-built_in">hsh</span>(v)]&gt;dis[u]+e[i].w)&#123;<br>				dis[<span class="hljs-built_in">hsh</span>(v)]=dis[u]+e[i].w;<br>				<span class="hljs-keyword">if</span>(!vis[<span class="hljs-built_in">hsh</span>(v)])&#123;<br>					q.<span class="hljs-built_in">push</span>(&#123;v,dis[<span class="hljs-built_in">hsh</span>(v)]&#125;);<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;	<br>	<span class="hljs-type">int</span> ans=<span class="hljs-number">0x3f3f3f3f</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">20</span>;i++) ans=<span class="hljs-built_in">min</span>(ans,dis[<span class="hljs-built_in">hsh</span>(&#123;t,i&#125;)]);<br>	<span class="hljs-keyword">if</span>(ans==<span class="hljs-number">0x3f3f3f3f</span>) cout&lt;&lt;<span class="hljs-string">&quot;-1&quot;</span>;<br>	<span class="hljs-keyword">else</span> cout&lt;&lt;ans;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="0227C">0227C</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> MOD=<span class="hljs-number">19260817</span>;<br><span class="hljs-type">int</span> m,f[<span class="hljs-number">110</span>][<span class="hljs-number">110</span>][<span class="hljs-number">10010</span>],h[<span class="hljs-number">110</span>][<span class="hljs-number">10010</span>],w[<span class="hljs-number">110</span>][<span class="hljs-number">10010</span>];<br><span class="hljs-type">int</span> dx[]=&#123;<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-2</span>,<span class="hljs-number">-2</span>&#125;,dy[]=&#123;<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">-2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>&#125;;<br><span class="hljs-type">int</span> tx[]=&#123;<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">-2</span>,<span class="hljs-number">-2</span>&#125;,ty[]=&#123;<span class="hljs-number">2</span>,<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">-2</span>&#125;;<br><span class="hljs-type">int</span> op,a,b,c,d,e;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">freopen</span>(<span class="hljs-string">&quot;chess.in&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>,stdin);<br>    <span class="hljs-built_in">freopen</span>(<span class="hljs-string">&quot;chess.out&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>,stdout);<br>	cin&gt;&gt;m;<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		cin&gt;&gt;op&gt;&gt;a&gt;&gt;b&gt;&gt;c&gt;&gt;d&gt;&gt;e;<br>		<span class="hljs-keyword">if</span>(e&gt;<span class="hljs-number">10000</span>)&#123;<span class="hljs-comment">//只有车</span><br>			a=a+b<span class="hljs-number">-2</span>;b=e;<span class="hljs-type">int</span> ans=<span class="hljs-number">1</span>;<br>			<span class="hljs-keyword">while</span>(b)&#123;<br>				<span class="hljs-keyword">if</span>(b&amp;<span class="hljs-number">1</span>) ans=ans*a%MOD;<br>				a=a*a%MOD;<br>				b&gt;&gt;=<span class="hljs-number">1</span>;<br>			&#125;<br>			cout&lt;&lt;ans&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>			<span class="hljs-keyword">continue</span>;<br>		&#125;<br>		f[c][d][<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>;<br>		h[c][<span class="hljs-number">0</span>]++,w[d][<span class="hljs-number">0</span>]++;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=e;i++)&#123;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=a;j++)&#123;<br>				<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>;k&lt;=b;k++)&#123;<br>					<span class="hljs-keyword">if</span>(op==<span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//车</span><br>						f[j][k][i]=(h[j][i<span class="hljs-number">-1</span>]+w[k][i<span class="hljs-number">-1</span>]%MOD<span class="hljs-number">-2</span>*f[j][k][i<span class="hljs-number">-1</span>]%MOD+MOD)%MOD;<br>						h[j][i]+=f[j][k][i],w[k][i]+=f[j][k][i];<br>						h[j][i]%=MOD,w[k][i]%=MOD;						<br>					&#125;<br>					<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<span class="hljs-comment">//马</span><br>						<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> l=<span class="hljs-number">0</span>;l&lt;<span class="hljs-number">8</span>;l++)&#123;<br>							<span class="hljs-keyword">if</span>(j+dx[l]&lt;=<span class="hljs-number">0</span>||j+dx[l]&gt;a||k+dy[l]&lt;=<span class="hljs-number">0</span>||k+dy[l]&gt;b) <span class="hljs-keyword">continue</span>;<br>							f[j][k][i]+=f[j+dx[l]][k+dy[l]][i<span class="hljs-number">-1</span>];<br>							f[j][k][i]%=MOD;<br>						&#125;						<br>					&#125;<br>					<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">//象</span><br>						<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> l=<span class="hljs-number">0</span>;l&lt;<span class="hljs-number">4</span>;l++)&#123;<br>							<span class="hljs-keyword">if</span>(j+tx[l]&lt;=<span class="hljs-number">0</span>||j+tx[l]&gt;a||k+ty[l]&lt;=<span class="hljs-number">0</span>||k+ty[l]&gt;b) <span class="hljs-keyword">continue</span>;<br>							f[j][k][i]+=f[j+tx[l]][k+ty[l]][i<span class="hljs-number">-1</span>];<br>							f[j][k][i]%=MOD;<br>						&#125;<br>					&#125;<br>				&#125;<br>			&#125;<br>		&#125;<br>		<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=a;i++)&#123;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=b;j++)&#123;<br>				ans+=f[i][j][e];<br>				ans%=MOD;<br>			&#125;<br>		&#125;<br>		cout&lt;&lt;ans&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;		<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=a;i++)&#123;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=b;j++)&#123;<br>				<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;k&lt;=e;k++)&#123;<br>					f[i][j][k]=<span class="hljs-number">0</span>;<br>					h[i][k]=<span class="hljs-number">0</span>,w[j][k]=<span class="hljs-number">0</span>;<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="0227D">0227D</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>,MOD=<span class="hljs-number">1e9</span><span class="hljs-number">+7</span>;<br><span class="hljs-type">int</span> n,head[N],tot,ans[N],a[N],b[N],fa[N][<span class="hljs-number">20</span>],lg[N],dep[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<span class="hljs-type">int</span> to,nxt;&#125;e[N];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addedge</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v)</span></span>&#123;<br>	e[++tot].nxt=head[u];<br>	e[tot].to=v;<br>	head[u]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	dep[u]=dep[fa[u][<span class="hljs-number">0</span>]]<span class="hljs-number">+1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=lg[dep[u]];i++)&#123;<br>		fa[u][i]=fa[fa[u][i<span class="hljs-number">-1</span>]][i<span class="hljs-number">-1</span>];<br>	&#125;<span class="hljs-comment">//预处理，lca要用</span><br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>		<span class="hljs-keyword">if</span>(e[i].to!=fa[u][<span class="hljs-number">0</span>])&#123;<br>			fa[e[i].to][<span class="hljs-number">0</span>]=u;<br>			<span class="hljs-built_in">dfs</span>(e[i].to);<br>			ans[u]+=ans[e[i].to];<span class="hljs-comment">//求答案</span><br>			ans[u]%=MOD;<br>		&#125;<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lca</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(dep[u]&lt;dep[v]) <span class="hljs-built_in">swap</span>(u,v);<br>	<span class="hljs-keyword">while</span>(dep[u]&gt;dep[v]) u=fa[u][lg[dep[u]-dep[v]]];<br>	<span class="hljs-keyword">if</span>(u==v) <span class="hljs-keyword">return</span> u;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=lg[dep[u]];i&gt;=<span class="hljs-number">0</span>;i--)&#123;<br>		<span class="hljs-keyword">if</span>(fa[u][i]!=fa[v][i]) u=fa[u][i],v=fa[v][i];<br>	&#125;<br>	<span class="hljs-keyword">return</span> fa[u][<span class="hljs-number">0</span>];<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	lg[<span class="hljs-number">0</span>]=<span class="hljs-number">-1</span>;<br>	cin&gt;&gt;n;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++)&#123;<br>		<span class="hljs-type">int</span> u,v;<br>		cin&gt;&gt;u&gt;&gt;v;<br>		<span class="hljs-built_in">addedge</span>(u,v);<br>		<span class="hljs-built_in">addedge</span>(v,u);<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		lg[i]=lg[i&gt;&gt;<span class="hljs-number">1</span>]<span class="hljs-number">+1</span>;<br>		cin&gt;&gt;a[i]&gt;&gt;b[i];<br>	&#125;<br>	<span class="hljs-built_in">dfs</span>(<span class="hljs-number">1</span>);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=i<span class="hljs-number">+1</span>;j&lt;=n;j++)&#123;<br>			ans[<span class="hljs-built_in">lca</span>(i,j)]+=<span class="hljs-number">2</span>*<span class="hljs-built_in">min</span>(<span class="hljs-built_in">abs</span>(a[i]-a[j]),<span class="hljs-built_in">abs</span>(b[i]-b[j]));<br>			ans[<span class="hljs-built_in">lca</span>(i,j)]%=MOD;<span class="hljs-comment">//对每个点对，在lca加上贡献。乘二是因为 (x,y) 与 (y,x) 各算一次贡献。</span><br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">dfs</span>(<span class="hljs-number">1</span>);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cout&lt;&lt;ans[i]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP1637">LuoguP1637</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,a[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">BIT</span>&#123;<br>	<span class="hljs-type">int</span> bit[N];<br>	<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> x&amp;-x;&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> k)</span></span>&#123;<span class="hljs-keyword">for</span>(;x&lt;N;x+=<span class="hljs-built_in">lowbit</span>(x)) bit[x]+=k;&#125;<br>	<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> res=<span class="hljs-number">0</span>)</span></span>&#123;<span class="hljs-keyword">for</span>(;x&gt;<span class="hljs-number">0</span>;x-=<span class="hljs-built_in">lowbit</span>(x)) res+=bit[x];<span class="hljs-keyword">return</span> res;&#125;<br>&#125;l,r;<br><span class="hljs-type">int</span> ans;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		cin&gt;&gt;a[i];<br>		r.<span class="hljs-built_in">add</span>(a[i],<span class="hljs-number">1</span>);<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		r.<span class="hljs-built_in">add</span>(a[i],<span class="hljs-number">-1</span>);<br>		ans+=l.<span class="hljs-built_in">query</span>(a[i]<span class="hljs-number">-1</span>)*(r.<span class="hljs-built_in">query</span>(N<span class="hljs-number">-1</span>)-r.<span class="hljs-built_in">query</span>(a[i]));<br>		l.<span class="hljs-built_in">add</span>(a[i],<span class="hljs-number">1</span>);<br>	&#125;<br>	cout&lt;&lt;ans;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP7706">LuoguP7706</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">5e5</span><span class="hljs-number">+10</span>,INF=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> n,m,a[N],b[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<span class="hljs-type">int</span> psi,maA,miB,maL,maR;&#125;tr[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(Node &amp;u,Node lc,Node rc)</span></span>&#123;<br>	u.maA=<span class="hljs-built_in">max</span>(lc.maA,rc.maA);<br>	u.miB=<span class="hljs-built_in">min</span>(lc.miB,rc.miB);<br>	u.maL=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(lc.maL,rc.maL),lc.maA-rc.miB);<br>	u.maR=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(lc.maR,rc.maR),rc.maA-lc.miB);<br>	u.psi=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(lc.psi,rc.psi),<span class="hljs-built_in">max</span>(lc.maL+rc.maA,lc.maA+rc.maR));<br>	<span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].maA=a[l];<br>		tr[u].miB=b[l];<br>		tr[u].maL=tr[u].maR=tr[u].psi=-INF;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-built_in">build</span>(ls,l,mid);<br>	<span class="hljs-built_in">build</span>(rs,mid<span class="hljs-number">+1</span>,r);<br>	<span class="hljs-built_in">pushup</span>(tr[u],tr[ls],tr[rs]);<br>	<span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U,<span class="hljs-type">int</span> k,<span class="hljs-type">bool</span> op)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		<span class="hljs-keyword">if</span>(!op) tr[u].maA=k;<br>		<span class="hljs-keyword">else</span> tr[u].miB=k;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">change</span>(ls,l,mid,U,k,op);<br>	<span class="hljs-keyword">else</span> <span class="hljs-built_in">change</span>(rs,mid<span class="hljs-number">+1</span>,r,U,k,op);<br>	<span class="hljs-built_in">pushup</span>(tr[u],tr[ls],tr[rs]);<br>&#125;<br><span class="hljs-function">Node <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R) <span class="hljs-keyword">return</span> tr[u];<br>	<span class="hljs-keyword">if</span>(L&lt;=mid&amp;&amp;R&gt;mid)&#123;<br>		Node res;<br>		<span class="hljs-built_in">pushup</span>(res,<span class="hljs-built_in">query</span>(ls,l,mid,L,R),<span class="hljs-built_in">query</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R));<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(L&lt;=mid) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(ls,l,mid,L,R);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;a[i];<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;b[i];<br>	<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n);<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		<span class="hljs-type">int</span> op,x,y;<br>		cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>) <span class="hljs-built_in">change</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,x,y,<span class="hljs-number">0</span>);<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">2</span>) <span class="hljs-built_in">change</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,x,y,<span class="hljs-number">1</span>);<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">3</span>) cout&lt;&lt;<span class="hljs-built_in">query</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,x,y).psi&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4146">LuoguP4146</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fa(x) tr[x].f</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(x) tr[x].s[0]</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(x) tr[x].s[1]</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">5e4</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,idx,root;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> s[<span class="hljs-number">2</span>],f,ma,addtag,siz,key;<br>	<span class="hljs-type">bool</span> revtag;<br>&#125;tr[N];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> x==<span class="hljs-built_in">rs</span>(<span class="hljs-built_in">fa</span>(x));&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>	tr[x].siz=tr[<span class="hljs-built_in">ls</span>(x)].siz+tr[<span class="hljs-built_in">rs</span>(x)].siz<span class="hljs-number">+1</span>;<br>	tr[x].ma=<span class="hljs-built_in">max</span>(tr[x].key,<span class="hljs-built_in">max</span>(tr[<span class="hljs-built_in">ls</span>(x)].ma,tr[<span class="hljs-built_in">rs</span>(x)].ma));<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">rotate</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-type">int</span> y=<span class="hljs-built_in">fa</span>(x),z=<span class="hljs-built_in">fa</span>(y),c=<span class="hljs-built_in">get</span>(x);<br>    <span class="hljs-keyword">if</span>(tr[x].s[c^<span class="hljs-number">1</span>]) <span class="hljs-built_in">fa</span>(tr[x].s[c^<span class="hljs-number">1</span>])=y;tr[y].s[c]=tr[x].s[c^<span class="hljs-number">1</span>];<br>    <span class="hljs-built_in">fa</span>(y)=x;tr[x].s[c^<span class="hljs-number">1</span>]=y;<br>    <span class="hljs-keyword">if</span>(z) tr[z].s[tr[z].s[<span class="hljs-number">1</span>]==y]=x;<span class="hljs-built_in">fa</span>(x)=z;<br>    <span class="hljs-built_in">pushup</span>(x);<span class="hljs-built_in">pushup</span>(y);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">splay</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> tgt)</span></span>&#123;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> y=<span class="hljs-built_in">fa</span>(x);y=<span class="hljs-built_in">fa</span>(x),y!=tgt;<span class="hljs-built_in">rotate</span>(x))&#123;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">fa</span>(y)!=tgt) <span class="hljs-built_in">rotate</span>(<span class="hljs-built_in">get</span>(y)==<span class="hljs-built_in">get</span>(x)?y:x);<br>	&#125;<br>	<span class="hljs-keyword">if</span>(!tgt) root=x;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(tr[x].addtag)&#123;<br>		<span class="hljs-type">int</span> k=tr[x].addtag;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(x))tr[<span class="hljs-built_in">ls</span>(x)].ma+=k,tr[<span class="hljs-built_in">ls</span>(x)].addtag+=k,tr[<span class="hljs-built_in">ls</span>(x)].key+=k;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(x))tr[<span class="hljs-built_in">rs</span>(x)].ma+=k,tr[<span class="hljs-built_in">rs</span>(x)].addtag+=k,tr[<span class="hljs-built_in">rs</span>(x)].key+=k;<br>		tr[x].addtag=<span class="hljs-number">0</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(tr[x].revtag)&#123;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(x)) <span class="hljs-built_in">swap</span>(<span class="hljs-built_in">ls</span>(<span class="hljs-built_in">ls</span>(x)),<span class="hljs-built_in">rs</span>(<span class="hljs-built_in">ls</span>(x))),tr[<span class="hljs-built_in">ls</span>(x)].revtag^=<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(x)) <span class="hljs-built_in">swap</span>(<span class="hljs-built_in">ls</span>(<span class="hljs-built_in">rs</span>(x)),<span class="hljs-built_in">rs</span>(<span class="hljs-built_in">rs</span>(x))),tr[<span class="hljs-built_in">rs</span>(x)].revtag^=<span class="hljs-number">1</span>;<br>		tr[x].revtag=<span class="hljs-number">0</span>;		<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-type">int</span> now=root;k++;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-built_in">pushdown</span>(now);<br>		<span class="hljs-type">int</span> siz=tr[<span class="hljs-built_in">ls</span>(now)].siz<span class="hljs-number">+1</span>;<br>		<span class="hljs-keyword">if</span>(k==siz) <span class="hljs-keyword">return</span> now;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(siz&gt;k) now=<span class="hljs-built_in">ls</span>(now);<br>		<span class="hljs-keyword">else</span> now=<span class="hljs-built_in">rs</span>(now),k-=siz;<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-type">int</span> x=<span class="hljs-built_in">find</span>(l<span class="hljs-number">-1</span>),y=<span class="hljs-built_in">find</span>(r<span class="hljs-number">+1</span>);<br>	<span class="hljs-built_in">splay</span>(x,<span class="hljs-number">0</span>);<span class="hljs-built_in">splay</span>(y,x);<br>	tr[<span class="hljs-built_in">ls</span>(y)].addtag+=k,tr[<span class="hljs-built_in">ls</span>(y)].ma+=k,tr[<span class="hljs-built_in">ls</span>(y)].key+=k;<br>	<span class="hljs-built_in">pushup</span>(y),<span class="hljs-built_in">pushup</span>(x);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reverse</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-type">int</span> x=<span class="hljs-built_in">find</span>(l<span class="hljs-number">-1</span>),y=<span class="hljs-built_in">find</span>(r<span class="hljs-number">+1</span>);<br>	<span class="hljs-built_in">splay</span>(x,<span class="hljs-number">0</span>);<span class="hljs-built_in">splay</span>(y,x);<br>	tr[<span class="hljs-built_in">ls</span>(y)].revtag^=<span class="hljs-number">1</span>;<br>	<span class="hljs-built_in">swap</span>(<span class="hljs-built_in">ls</span>(<span class="hljs-built_in">ls</span>(y)),<span class="hljs-built_in">rs</span>(<span class="hljs-built_in">ls</span>(y)));<br>	<span class="hljs-built_in">pushup</span>(y);<span class="hljs-built_in">pushup</span>(x);		<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-type">int</span> x=<span class="hljs-built_in">find</span>(l<span class="hljs-number">-1</span>),y=<span class="hljs-built_in">find</span>(r<span class="hljs-number">+1</span>);<br>	<span class="hljs-built_in">splay</span>(x,<span class="hljs-number">0</span>);<span class="hljs-built_in">splay</span>(y,x);<br>	<span class="hljs-keyword">return</span> tr[<span class="hljs-built_in">ls</span>(y)].ma;	<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> f)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l&gt;r)<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>	<span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>	tr[mid].f=f;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		<span class="hljs-keyword">if</span>(l==<span class="hljs-number">1</span>||l==n<span class="hljs-number">+2</span>) tr[l].ma=tr[l].key=<span class="hljs-number">-1e9</span>;<br>		tr[l].siz=<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">return</span> l;<br>	&#125;<br>	<span class="hljs-built_in">ls</span>(mid)=<span class="hljs-built_in">build</span>(l,mid<span class="hljs-number">-1</span>,mid);<br>	<span class="hljs-built_in">rs</span>(mid)=<span class="hljs-built_in">build</span>(mid<span class="hljs-number">+1</span>,r,mid);<br>	<span class="hljs-built_in">pushup</span>(mid);<br>	<span class="hljs-keyword">return</span> mid;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	tr[<span class="hljs-number">0</span>].ma=<span class="hljs-number">-1e9</span>;<br>	root=<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>,n<span class="hljs-number">+2</span>,<span class="hljs-number">0</span>);<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		<span class="hljs-type">int</span> op,l,r,v;<br>		cin&gt;&gt;op&gt;&gt;l&gt;&gt;r;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<br>			cin&gt;&gt;v;<br>			<span class="hljs-built_in">add</span>(l,r,v);<br>		&#125;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">3</span>) cout&lt;&lt;<span class="hljs-built_in">query</span>(l,r)&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">2</span>) <span class="hljs-built_in">reverse</span>(l,r);<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3793">LuoguP3793</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-keyword">namespace</span> GenHelper&#123;<br>    <span class="hljs-type">unsigned</span> z1,z2,z3,z4,b;<br>    <span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-title">rand_</span><span class="hljs-params">()</span></span>&#123;<br>        b=((z1&lt;&lt;<span class="hljs-number">6</span>)^z1)&gt;&gt;<span class="hljs-number">13</span>;<br>        z1=((z1&amp;<span class="hljs-number">4294967294U</span>)&lt;&lt;<span class="hljs-number">18</span>)^b;<br>        b=((z2&lt;&lt;<span class="hljs-number">2</span>)^z2)&gt;&gt;<span class="hljs-number">27</span>;<br>        z2=((z2&amp;<span class="hljs-number">4294967288U</span>)&lt;&lt;<span class="hljs-number">2</span>)^b;<br>        b=((z3&lt;&lt;<span class="hljs-number">13</span>)^z3)&gt;&gt;<span class="hljs-number">21</span>;<br>        z3=((z3&amp;<span class="hljs-number">4294967280U</span>)&lt;&lt;<span class="hljs-number">7</span>)^b;<br>        b=((z4&lt;&lt;<span class="hljs-number">3</span>)^z4)&gt;&gt;<span class="hljs-number">12</span>;<br>        z4=((z4&amp;<span class="hljs-number">4294967168U</span>)&lt;&lt;<span class="hljs-number">13</span>)^b;<br>        <span class="hljs-keyword">return</span> (z1^z2^z3^z4);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">srand</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> x)</span></span>&#123;<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> GenHelper;z1=x; z2=(~x)^<span class="hljs-number">0x233333333U</span>; z3=x^<span class="hljs-number">0x1234598766U</span>; z4=(~x)<span class="hljs-number">+51</span>;&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> GenHelper;<br>    <span class="hljs-type">int</span> a=<span class="hljs-built_in">rand_</span>()&amp;<span class="hljs-number">32767</span>;<br>    <span class="hljs-type">int</span> b=<span class="hljs-built_in">rand_</span>()&amp;<span class="hljs-number">32767</span>;<br>    <span class="hljs-keyword">return</span> a*<span class="hljs-number">32768</span>+b;<br>&#125;<br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e7</span><span class="hljs-number">+10</span>,M=<span class="hljs-number">5000</span>;<br><span class="hljs-type">int</span> n,m,s,B,bel[N],L[M],R[M],a[N],cnt;<br><span class="hljs-type">int</span> st[M][<span class="hljs-number">14</span>],bg[M][M],ed[M][M];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ans;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s;<br>    <span class="hljs-built_in">srand</span>(s);<br>    B=<span class="hljs-built_in">sqrt</span>(n);cnt=n/B;<span class="hljs-keyword">if</span>(n%B) cnt++;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        a[i]=<span class="hljs-built_in">read</span>();<br>        bel[i]=(i<span class="hljs-number">-1</span>)/B<span class="hljs-number">+1</span>;<br>        st[bel[i]][<span class="hljs-number">0</span>]=<span class="hljs-built_in">max</span>(st[bel[i]][<span class="hljs-number">0</span>],a[i]);<br>        bg[bel[i]][(i<span class="hljs-number">-1</span>)%B<span class="hljs-number">+1</span>]=<span class="hljs-built_in">max</span>(bg[bel[i]][(i<span class="hljs-number">-1</span>)%B],a[i]);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=cnt;i++) L[i]=(i<span class="hljs-number">-1</span>)*B<span class="hljs-number">+1</span>,R[i]=<span class="hljs-built_in">min</span>(n,i*B);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=n;i&gt;=<span class="hljs-number">1</span>;i--)&#123;<br>        ed[bel[i]][(i<span class="hljs-number">-1</span>)%B<span class="hljs-number">+1</span>]=<span class="hljs-built_in">max</span>(ed[bel[i]][(i<span class="hljs-number">-1</span>)%B<span class="hljs-number">+2</span>],a[i]);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">13</span>;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j+(<span class="hljs-number">1</span>&lt;&lt;i)<span class="hljs-number">-1</span>&lt;=cnt;j++)&#123;<br>            st[j][i]=<span class="hljs-built_in">max</span>(st[j][i<span class="hljs-number">-1</span>],st[j+(<span class="hljs-number">1</span>&lt;&lt;(i<span class="hljs-number">-1</span>))][i<span class="hljs-number">-1</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">while</span>(m--)&#123;<br>        <span class="hljs-type">int</span> l=<span class="hljs-built_in">read</span>()%n<span class="hljs-number">+1</span>,r=<span class="hljs-built_in">read</span>()%n<span class="hljs-number">+1</span>;<br>        <span class="hljs-keyword">if</span>(l&gt;r) <span class="hljs-built_in">swap</span>(l,r);<br>        <span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span>(bel[l]==bel[r])&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=r;i++) res=<span class="hljs-built_in">max</span>(res,a[i]);<br>            ans+=res;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        res=<span class="hljs-built_in">max</span>(bg[bel[r]][(r<span class="hljs-number">-1</span>)%B<span class="hljs-number">+1</span>],ed[bel[l]][(l<span class="hljs-number">-1</span>)%B<span class="hljs-number">+1</span>]);<br>        <span class="hljs-type">int</span> x=bel[l]<span class="hljs-number">+1</span>,y=bel[r]<span class="hljs-number">-1</span>;<br>        <span class="hljs-keyword">if</span>(x&lt;=y)&#123;<br>            <span class="hljs-type">int</span> k=<span class="hljs-built_in">log2</span>(y-x<span class="hljs-number">+1</span>);<br>            res=<span class="hljs-built_in">max</span>(res,<span class="hljs-built_in">max</span>(st[x][k],st[y-(<span class="hljs-number">1</span>&lt;&lt;k)<span class="hljs-number">+1</span>][k]));    <br>        &#125;<br>        ans+=res;   <br>    &#125;<br>    cout&lt;&lt;ans;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP9981">LuoguP9981</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<span class="hljs-type">int</span> to,w;&#125;;<br><span class="hljs-type">int</span> n,m,tot,cnt,tp[N],in[N],dep[N],rk[N],id[N];<br><span class="hljs-type">long</span> <span class="hljs-type">long</span> ans[N];<br>vector&lt;Edge&gt; v[N],v2[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">res</span>&#123;<br>    <span class="hljs-type">int</span> e,rnk,to;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt;(<span class="hljs-type">const</span> res &amp;t)<span class="hljs-type">const</span>&#123;<br>        <span class="hljs-keyword">return</span> e==t.e?rnk&gt;t.rnk:e&lt;t.e;<br>    &#125;<br>&#125;;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<span class="hljs-keyword">return</span> dep[x]&lt;dep[y];&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-type">int</span> x,y,w;<br>		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld%lld&quot;</span>,&amp;x,&amp;y,&amp;w);<br>		v[x].<span class="hljs-built_in">push_back</span>(&#123;y,w&#125;);<br>        in[x]++;<br>		v2[y].<span class="hljs-built_in">push_back</span>(&#123;x,w&#125;);<br>	&#125;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-keyword">if</span>(!in[i]) q.<span class="hljs-built_in">push</span>(i);<br>	<span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>		<span class="hljs-type">int</span> x=q.<span class="hljs-built_in">front</span>();<br>        q.<span class="hljs-built_in">pop</span>();<br>		tp[++tot]=x;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:v2[x])&#123;<br>			<span class="hljs-keyword">if</span>(in[it.to])&#123;<br>				in[it.to]--;<br>				<span class="hljs-keyword">if</span>(!in[it.to]) q.<span class="hljs-built_in">push</span>(it.to);<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-type">int</span> x=tp[i];<br>		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:v2[x])&#123;<br>			dep[it.to]=<span class="hljs-built_in">max</span>(dep[it.to],dep[x]<span class="hljs-number">+1</span>);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) id[i]=i;<br>	<span class="hljs-built_in">sort</span>(id<span class="hljs-number">+1</span>,id+n<span class="hljs-number">+1</span>,cmp);<br>	priority_queue&lt;res&gt; pq;<br>	<span class="hljs-type">int</span> mxdep=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-type">int</span> x=id[i];<br>		<span class="hljs-keyword">if</span>(dep[x] != mxdep)&#123;<br>			mxdep=dep[x];<br>			<span class="hljs-keyword">while</span>(!pq.<span class="hljs-built_in">empty</span>())&#123;<br>				<span class="hljs-keyword">auto</span> it=pq.<span class="hljs-built_in">top</span>();pq.<span class="hljs-built_in">pop</span>();<br>				rk[it.to]=++cnt;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">if</span>(dep[x])&#123;<br>			<span class="hljs-type">int</span> mn=<span class="hljs-number">0x3f3f3f3f</span>,mx=<span class="hljs-number">0</span>;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:v[x])&#123;<br>				<span class="hljs-keyword">if</span>(dep[it.to]==dep[x]<span class="hljs-number">-1</span>) mn=<span class="hljs-built_in">min</span>(mn,it.w);<br>			&#125;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:v[x])&#123;<br>				<span class="hljs-keyword">if</span>(dep[it.to]==dep[x]<span class="hljs-number">-1</span>&amp;&amp;it.w==mn) mx=<span class="hljs-built_in">max</span>(mx,rk[it.to]);<br>			&#125;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:v[x])&#123;<br>				<span class="hljs-keyword">if</span>(dep[it.to]==dep[x]<span class="hljs-number">-1</span>&amp;&amp;it.w==mn&amp;&amp;rk[it.to]==mx)&#123;<br>					ans[x]=ans[it.to]+it.w;<br>					pq.<span class="hljs-built_in">push</span>(&#123;it.w,rk[it.to],x&#125;);<br>					<span class="hljs-keyword">break</span>;<br>				&#125;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,x&#125;);<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld %lld\n&quot;</span>,dep[i],ans[i]);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP10475">LuoguP10475</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">int</span> r,c,nxt[<span class="hljs-number">10010</span>],ans1,ans2;<br><span class="hljs-type">int</span> hsh[<span class="hljs-number">10010</span>];<br><span class="hljs-type">char</span> mp[<span class="hljs-number">10010</span>][<span class="hljs-number">100</span>];<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld&quot;</span>,&amp;r,&amp;c);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=r;i++) <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,mp[i]<span class="hljs-number">+1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=r;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=c;j++)&#123;<br>            hsh[i<span class="hljs-number">-1</span>]=(hsh[i<span class="hljs-number">-1</span>]*<span class="hljs-number">20070903</span>+mp[i][j]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;r;i++)&#123;<br>        <span class="hljs-keyword">while</span>(j&gt;<span class="hljs-number">0</span>&amp;&amp;hsh[i]!=hsh[j]) j=nxt[j<span class="hljs-number">-1</span>];<br>        <span class="hljs-keyword">if</span>(hsh[i]==hsh[j]) j++;<br>        nxt[i]=j;<br>    &#125;<br>    ans1=r-nxt[r<span class="hljs-number">-1</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;r;i++) hsh[i]=nxt[i]=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=c;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=r;j++)&#123;<br>            hsh[i<span class="hljs-number">-1</span>]=(hsh[i<span class="hljs-number">-1</span>]*<span class="hljs-number">20070903</span>+mp[j][i]);<br>        &#125;<br>    &#125;<br>    j=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;c;i++)&#123;<br>        <span class="hljs-keyword">while</span>(j&gt;<span class="hljs-number">0</span>&amp;&amp;hsh[i]!=hsh[j]) j=nxt[j<span class="hljs-number">-1</span>];<br>        <span class="hljs-keyword">if</span>(hsh[i]==hsh[j]) j++;<br>        nxt[i]=j;<br>    &#125;<br>    ans2=c-nxt[c<span class="hljs-number">-1</span>];  <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,ans1*ans2);<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP10195">LuoguP10195</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,p[N],v[N],nxt[N],pre[N],ans[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> x,y,ti;<br>	<span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Node a) <span class="hljs-type">const</span>&#123;<br>		<span class="hljs-keyword">return</span> ti&gt;a.ti;<br>	&#125;<br>&#125;;<br>priority_queue&lt;Node&gt; q;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">calc</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">2</span>*(<span class="hljs-built_in">ceil</span>(((p[y]-p[x])*<span class="hljs-number">1.0</span>)/((v[x]+v[y])*<span class="hljs-number">1.0</span>)))-x%<span class="hljs-number">2</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span></span>&#123;<br>	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;n);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) nxt[i]=i<span class="hljs-number">+1</span>,pre[i]=i<span class="hljs-number">-1</span>,ans[i]=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>()) q.<span class="hljs-built_in">pop</span>();<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;p[i]);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;v[i]);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++) q.<span class="hljs-built_in">push</span>(&#123;i,i<span class="hljs-number">+1</span>,<span class="hljs-built_in">calc</span>(i,i<span class="hljs-number">+1</span>)&#125;);<br>	<span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>		Node f=q.<span class="hljs-built_in">top</span>();<br>		q.<span class="hljs-built_in">pop</span>();<br>		<span class="hljs-keyword">if</span>(ans[f.x]||ans[f.y]) <span class="hljs-keyword">continue</span>;<br>		ans[f.x]=ans[f.y]=f.ti;<br>		<span class="hljs-keyword">if</span>(pre[f.x]&gt;=<span class="hljs-number">1</span>&amp;&amp;nxt[f.y]&lt;=n)&#123;<br>			q.<span class="hljs-built_in">push</span>(&#123;pre[f.x],nxt[f.y],<span class="hljs-built_in">calc</span>(pre[f.x],nxt[f.y])&#125;);<br>		&#125;<br>		nxt[pre[f.x]]=nxt[f.x];<br>		pre[nxt[f.x]]=pre[f.x];<br>		nxt[pre[f.y]]=nxt[f.y];<br>		pre[nxt[f.y]]=pre[f.y];<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld &quot;</span>,ans[i]);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> T;<br>	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;T);<br>	<span class="hljs-keyword">while</span>(T--) <span class="hljs-built_in">solve</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4185">LuoguP4185</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,ans[N],fa[N],siz[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<br>    <span class="hljs-type">int</span> u,v,r;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Edge &amp;t) <span class="hljs-type">const</span>&#123;<br>        <span class="hljs-keyword">return</span> r&gt;t.r;<br>    &#125;<br>&#125;e[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Query</span>&#123;<br>    <span class="hljs-type">int</span> k,v,id;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Query &amp;t) <span class="hljs-type">const</span>&#123;<br>        <span class="hljs-keyword">return</span> k&gt;t.k;<br>    &#125;<br>&#125;q[N];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> fa[x]==x?x:<span class="hljs-built_in">find</span>(fa[x]);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>    <span class="hljs-type">int</span> fx=<span class="hljs-built_in">find</span>(x),fy=<span class="hljs-built_in">find</span>(y);<br>    <span class="hljs-keyword">if</span>(fx==fy) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">if</span>(siz[fx]&gt;siz[fy]) <span class="hljs-built_in">swap</span>(fx,fy);<br>    fa[fx]=fy;siz[fy]+=siz[fx];<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++)&#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld%lld&quot;</span>,&amp;e[i].u,&amp;e[i].v,&amp;e[i].r);<br>        fa[i]=i;siz[i]=<span class="hljs-number">1</span>;<br>    &#125; <br>    fa[n]=n,siz[n]=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld&quot;</span>,&amp;q[i].k,&amp;q[i].v);<br>        q[i].id=i;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(e<span class="hljs-number">+1</span>,e+n<span class="hljs-number">+1</span>);<br>    <span class="hljs-built_in">sort</span>(q<span class="hljs-number">+1</span>,q+m<span class="hljs-number">+1</span>);<br>    <span class="hljs-type">int</span> pos=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-keyword">while</span>(e[pos].r&gt;=q[i].k) <span class="hljs-built_in">merge</span>(e[pos].u,e[pos].v),++pos;<br>        ans[q[i].id]=siz[<span class="hljs-built_in">find</span>(q[i].v)]<span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans[i]);<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP1955">LuoguP1955</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,x[N&lt;&lt;<span class="hljs-number">2</span>],tot,fa[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Query</span>&#123;<span class="hljs-type">int</span> a,b,e;&#125;q[N];<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(Query a,Query b)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> a.e==b.e?a.a&lt;b.a:a.e&gt;b.e;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> fa[x]==x?x:fa[x]=<span class="hljs-built_in">find</span>(fa[x]);&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">find</span>(x)==<span class="hljs-built_in">find</span>(y)) <span class="hljs-keyword">return</span>;<br>    fa[<span class="hljs-built_in">find</span>(x)]=<span class="hljs-built_in">find</span>(y);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span></span>&#123;<br>    tot=<span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;n);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld%lld&quot;</span>,&amp;q[i].a,&amp;q[i].b,&amp;q[i].e);<br>        x[++tot]=q[i].a;x[++tot]=q[i].b;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(x<span class="hljs-number">+1</span>,x+tot<span class="hljs-number">+1</span>);<br>    tot=<span class="hljs-built_in">unique</span>(x<span class="hljs-number">+1</span>,x+tot<span class="hljs-number">+1</span>)-x<span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=tot;i++) fa[i]=i;<br>    <span class="hljs-built_in">sort</span>(q<span class="hljs-number">+1</span>,q+n<span class="hljs-number">+1</span>,cmp);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        q[i].a=<span class="hljs-built_in">lower_bound</span>(x<span class="hljs-number">+1</span>,x+tot<span class="hljs-number">+1</span>,q[i].a)-x;<br>        q[i].b=<span class="hljs-built_in">lower_bound</span>(x<span class="hljs-number">+1</span>,x+tot<span class="hljs-number">+1</span>,q[i].b)-x;<br>        <span class="hljs-keyword">if</span>(q[i].e) <span class="hljs-built_in">merge</span>(q[i].a,q[i].b);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">find</span>(q[i].a)==<span class="hljs-built_in">find</span>(q[i].b))&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;NO\n&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;YES\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> T;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;T);<br>    <span class="hljs-keyword">while</span>(T--) <span class="hljs-built_in">solve</span>();<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4479">LuoguP4479</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">100005</span>;<br><span class="hljs-type">int</span> n,k,X[N],bit[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span>&#123;<br>    <span class="hljs-type">int</span> x,y,idx,t;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Point &amp;b) <span class="hljs-type">const</span>&#123;<br>        <span class="hljs-keyword">return</span> t==b.t?x&lt;b.x:t&lt;b.t;<br>    &#125;<br>&#125;p[N];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> x &amp; -x;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">for</span>(;x&lt;=n;x+=<span class="hljs-built_in">lowbit</span>(x)) bit[x]++;&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(;x&gt;<span class="hljs-number">0</span>;x-=<span class="hljs-built_in">lowbit</span>(x)) ans+=bit[x];<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">check</span><span class="hljs-params">(<span class="hljs-type">int</span> mid)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) p[i].t=p[i].y-mid*p[i].x;<br>    <span class="hljs-built_in">sort</span>(p<span class="hljs-number">+1</span>,p+n<span class="hljs-number">+1</span>);<br>    <span class="hljs-built_in">memset</span>(bit,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(bit));<br>    <span class="hljs-type">int</span> rnk=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        rnk+=<span class="hljs-built_in">query</span>(p[i].idx<span class="hljs-number">-1</span>);<br>        <span class="hljs-built_in">update</span>(p[i].idx);<br>    &#125;<br>    <span class="hljs-keyword">return</span> rnk&gt;=k;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    cin&gt;&gt;n&gt;&gt;k;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>    	cin&gt;&gt;p[i].x&gt;&gt;p[i].y;<br>    	X[i]=p[i].x;<br>	&#125;<br>    <span class="hljs-built_in">sort</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>);<br>    <span class="hljs-type">int</span> tot=<span class="hljs-built_in">unique</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>)-X<span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) p[i].idx=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+tot<span class="hljs-number">+1</span>,p[i].x)-X;<br>    <span class="hljs-type">int</span> l=<span class="hljs-number">-2e8</span>,r=<span class="hljs-number">2e8</span>,ans;<br>    <span class="hljs-keyword">while</span>(l&lt;=r)&#123;<br>        <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>(mid))&#123;<br>            ans=mid;<br>            l=mid<span class="hljs-number">+1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> r=mid<span class="hljs-number">-1</span>;<br>    &#125;<br>    cout&lt;&lt;ans;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP1966">LuoguP1966</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>,MOD=<span class="hljs-number">1e8</span><span class="hljs-number">-3</span>;<br><span class="hljs-type">int</span> A[N],B[N],a[N],b[N],l[N],bit[<span class="hljs-number">5</span>*N],ans,n;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<span class="hljs-keyword">for</span>(;x&lt;=n;x+=x&amp;-x) bit[x]+=y;&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>	<span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(;x;x-=x&amp;-x) res+=bit[x];<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp1</span><span class="hljs-params">(<span class="hljs-type">int</span> i,<span class="hljs-type">int</span> j)</span></span>&#123;<span class="hljs-keyword">return</span> A[i]&lt;A[j];&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp2</span><span class="hljs-params">(<span class="hljs-type">int</span> i,<span class="hljs-type">int</span> j)</span></span>&#123;<span class="hljs-keyword">return</span> B[i]&lt;B[j];&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	cin&gt;&gt;n;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		cin&gt;&gt;A[i];<br>		a[i]=i;<br>	&#125; <br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		cin&gt;&gt;B[i];<br>		b[i]=i;<br>	&#125;<br>	<span class="hljs-built_in">sort</span>(a<span class="hljs-number">+1</span>,a<span class="hljs-number">+1</span>+n);<span class="hljs-built_in">sort</span>(b<span class="hljs-number">+1</span>,b<span class="hljs-number">+1</span>+n);<br>	<span class="hljs-built_in">sort</span>(a<span class="hljs-number">+1</span>,a<span class="hljs-number">+1</span>+n,cmp1);<span class="hljs-built_in">sort</span>(b<span class="hljs-number">+1</span>,b<span class="hljs-number">+1</span>+n,cmp2);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) l[a[i]]=b[i];<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=n;i;i--)&#123;<br>		ans=(ans+<span class="hljs-built_in">query</span>(l[i]<span class="hljs-number">-1</span>))%MOD;<br>		<span class="hljs-built_in">add</span>(l[i],<span class="hljs-number">1</span>);	<br>	&#125;<br>	cout&lt;&lt;ans%MOD&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3605">LuoguP3605</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,p[N],x[N],bit[N],ans[N];<br>vector&lt;vector&lt;<span class="hljs-type">int</span>&gt; &gt; <span class="hljs-built_in">ch</span>(N);<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> x&amp;-x;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=x;i&lt;=n;i+=<span class="hljs-built_in">lowbit</span>(i)) bit[i]+=k;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=x;i&gt;<span class="hljs-number">0</span>;i-=<span class="hljs-built_in">lowbit</span>(i)) res+=bit[i];<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>    ans[u]=-<span class="hljs-built_in">query</span>(p[u]<span class="hljs-number">-1</span>);<br>    <span class="hljs-built_in">add</span>(p[u],<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> v:ch[u]) <span class="hljs-built_in">dfs</span>(v);<br>    ans[u]+=<span class="hljs-built_in">query</span>(p[u]<span class="hljs-number">-1</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;n);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,p+i);<br>        x[i]=p[i];<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(x<span class="hljs-number">+1</span>,x+n<span class="hljs-number">+1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) p[i]=n-(<span class="hljs-built_in">lower_bound</span>(x<span class="hljs-number">+1</span>,x+n<span class="hljs-number">+1</span>,p[i])-x)<span class="hljs-number">+1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-type">int</span> t;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;t);<br>        ch[t].<span class="hljs-built_in">push_back</span>(i);<br>    &#125;<br>    <span class="hljs-built_in">dfs</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans[i]);<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP1972">LuoguP1972</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;map&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e6</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,q,a[N],ans[N],bit[N];<br>vector&lt;vector&lt;pair&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; &gt; &gt; <span class="hljs-built_in">v</span>(N);<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> x&amp;-x;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=x;i&lt;=n;i+=<span class="hljs-built_in">lowbit</span>(i)) bit[i]+=k;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=x;i&gt;<span class="hljs-number">0</span>;i-=<span class="hljs-built_in">lowbit</span>(i)) res+=bit[i];<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,&amp;n);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld&quot;</span>,a+i);<br>    cin&gt;&gt;q;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=q;i++)&#123;<br>        <span class="hljs-type">int</span> x,y;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld&quot;</span>,&amp;x,&amp;y);<br>        v[x].<span class="hljs-built_in">push_back</span>(&#123;y,i&#125;);<br>    &#125;<br>    map&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; lst;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=n;i&gt;<span class="hljs-number">0</span>;i--)&#123;<br>        <span class="hljs-keyword">if</span>(lst.<span class="hljs-built_in">count</span>(a[i])) <span class="hljs-built_in">add</span>(lst[a[i]],<span class="hljs-number">-1</span>);<br>        lst[a[i]]=i;<br>        <span class="hljs-built_in">add</span>(i,<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> j:v[i]) ans[j.second]=<span class="hljs-built_in">query</span>(j.first);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=q;i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans[i]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4113">LuoguP4113</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e6</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> c,n,m,a[N],ans[N],lst[N],lst1[N],bit[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Query</span>&#123;<br>	<span class="hljs-type">int</span> l,r,id;<br>	<span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Query &amp;t) <span class="hljs-type">const</span>&#123;<br>		<span class="hljs-keyword">return</span> r==t.r?l&lt;t.l:r&lt;t.r;<br>	&#125;<br>&#125;q[N];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> x&amp;-x;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=x;i&lt;=n;i+=<span class="hljs-built_in">lowbit</span>(i)) bit[i]+=k;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>	<span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=x;i&gt;<span class="hljs-number">0</span>;i-=<span class="hljs-built_in">lowbit</span>(i)) res+=bit[i];<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;c&gt;&gt;m;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;a[i];<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>		cin&gt;&gt;q[i].l&gt;&gt;q[i].r;<br>		q[i].id=i;<br>	&#125;<br>	<span class="hljs-built_in">sort</span>(q<span class="hljs-number">+1</span>,q+m<span class="hljs-number">+1</span>);<br>	<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++)&#123;<br>		<span class="hljs-keyword">for</span>(;i&lt;=q[j].r;i++)&#123;<br>			<span class="hljs-keyword">if</span>(lst1[a[i]])&#123;<br>				<span class="hljs-built_in">add</span>(lst1[a[i]],<span class="hljs-number">-1</span>);<br>				lst1[a[i]]=lst[a[i]];<br>				lst[a[i]]=i;<br>				<span class="hljs-built_in">add</span>(lst1[a[i]],<span class="hljs-number">1</span>);<br>			&#125;<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(lst[a[i]])&#123;<br>				lst1[a[i]]=lst[a[i]];<br>				lst[a[i]]=i;<br>				<span class="hljs-built_in">add</span>(lst1[a[i]],<span class="hljs-number">1</span>);<br>			&#125;<br>			<span class="hljs-keyword">else</span> lst[a[i]]=i;			<br>		&#125;<br>		ans[q[j].id]=<span class="hljs-built_in">query</span>(q[j].r)-<span class="hljs-built_in">query</span>(q[j].l<span class="hljs-number">-1</span>);<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++) cout&lt;&lt;ans[i]&lt;&lt;endl;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3586">LuoguP3586</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(x) tr[(x)].s[0]</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(x) tr[(x)].s[1]</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fa(x) tr[(x)].fa</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e6</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,idx,root;<br><span class="hljs-type">int</span> p[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>    <span class="hljs-type">int</span> sum,siz,s[<span class="hljs-number">2</span>],fa,key;<br>&#125;tr[N];<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-keyword">return</span> x==<span class="hljs-built_in">rs</span>(<span class="hljs-built_in">fa</span>(x));&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">maintain</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    tr[x].siz=tr[<span class="hljs-built_in">ls</span>(x)].siz+tr[<span class="hljs-built_in">rs</span>(x)].siz<span class="hljs-number">+1</span>;<br>    tr[x].sum=tr[<span class="hljs-built_in">ls</span>(x)].sum+tr[<span class="hljs-built_in">rs</span>(x)].sum+tr[x].key;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">newnode</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span></span>&#123;tr[++idx].key=key,tr[idx].sum=key,tr[idx].siz=<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> idx;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<span class="hljs-built_in">ls</span>(x)=<span class="hljs-built_in">rs</span>(x)=<span class="hljs-built_in">fa</span>(x)=tr[x].siz=tr[x].key=tr[x].sum=<span class="hljs-number">0</span>;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">rotate</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-type">int</span> y=<span class="hljs-built_in">fa</span>(x),z=<span class="hljs-built_in">fa</span>(y),c=<span class="hljs-built_in">get</span>(x);<br>    <span class="hljs-keyword">if</span>(tr[x].s[c^<span class="hljs-number">1</span>]) <span class="hljs-built_in">fa</span>(tr[x].s[c^<span class="hljs-number">1</span>])=y; tr[y].s[c]=tr[x].s[c^<span class="hljs-number">1</span>];<br>    tr[x].s[c^<span class="hljs-number">1</span>]=y,<span class="hljs-built_in">fa</span>(y)=x;<br>    <span class="hljs-keyword">if</span>(z) tr[z].s[tr[z].s[<span class="hljs-number">1</span>]==y]=x;<span class="hljs-built_in">fa</span>(x)=z;<br>    <span class="hljs-built_in">maintain</span>(y);<span class="hljs-built_in">maintain</span>(x);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">splay</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> y=<span class="hljs-built_in">fa</span>(x);y=<span class="hljs-built_in">fa</span>(x),y;<span class="hljs-built_in">rotate</span>(x))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">fa</span>(y)) <span class="hljs-built_in">rotate</span>(<span class="hljs-built_in">get</span>(y)==<span class="hljs-built_in">get</span>(x)?y:x);<br>    &#125;<br>    root=x;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ins</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span></span>&#123;<br>    <span class="hljs-type">int</span> now=root,f=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(now)&#123;<br>        f=now;<br>        now=tr[now].s[key&gt;=tr[now].key];<br>    &#125;<br>    now=<span class="hljs-built_in">newnode</span>(key);<br>    <span class="hljs-built_in">fa</span>(now)=f;tr[f].s[key&gt;=tr[f].key]=now;<br>    <span class="hljs-built_in">splay</span>(now);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span></span>&#123;<br>    <span class="hljs-type">int</span> now=root,p=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(tr[now].key!=key&amp;&amp;now)&#123;<br>        p=now;<br>        now=tr[now].s[key&gt;=tr[now].key];<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!now)&#123;<span class="hljs-built_in">splay</span>(p);<span class="hljs-keyword">return</span>;&#125;<br>    <span class="hljs-built_in">splay</span>(now);<br>    <span class="hljs-type">int</span> cur=<span class="hljs-built_in">ls</span>(now);<br>    <span class="hljs-keyword">if</span>(!cur)&#123;<br>        root=<span class="hljs-built_in">rs</span>(now);<span class="hljs-built_in">fa</span>(<span class="hljs-built_in">rs</span>(now))=<span class="hljs-number">0</span>;<span class="hljs-built_in">clear</span>(now);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">rs</span>(cur)) cur=<span class="hljs-built_in">rs</span>(cur);<br>    <span class="hljs-built_in">fa</span>(<span class="hljs-built_in">rs</span>(now))=cur;<span class="hljs-built_in">rs</span>(cur)=<span class="hljs-built_in">rs</span>(now);<span class="hljs-built_in">fa</span>(<span class="hljs-built_in">ls</span>(now))=<span class="hljs-number">0</span>;<span class="hljs-built_in">clear</span>(now);<br>    <span class="hljs-built_in">maintain</span>(cur);<br>    <span class="hljs-built_in">splay</span>(cur);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) <span class="hljs-built_in">ins</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">while</span>(m--)&#123;<br>        <span class="hljs-type">char</span> op;<br>        <span class="hljs-type">int</span> x,y;<br>        cin&gt;&gt;op;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%lld%lld&quot;</span>,&amp;x,&amp;y);<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-string">&#x27;U&#x27;</span>)&#123;<br>            <span class="hljs-built_in">del</span>(p[x]),p[x]=y,<span class="hljs-built_in">ins</span>(y);     <br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-built_in">ins</span>(y);<br>            <span class="hljs-type">int</span> sum=tr[<span class="hljs-built_in">ls</span>(root)].sum;<br>            <span class="hljs-type">int</span> siz=tr[root].siz-tr[<span class="hljs-built_in">ls</span>(root)].siz<span class="hljs-number">-1</span>;<br>            <span class="hljs-built_in">del</span>(y);<br>            <span class="hljs-keyword">if</span>(sum&gt;=(x-siz)*y) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;TAK\n&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;NIE\n&quot;</span>);<br>        &#125;<br>    &#125;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4588">LuoguP4588</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> tr[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-type">int</span> q,MOD;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;tr[u]=tr[ls]*tr[rs]%MOD;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u]=<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-built_in">build</span>(ls,l,mid);<br>	<span class="hljs-built_in">build</span>(rs,mid<span class="hljs-number">+1</span>,r);<br>	<span class="hljs-built_in">pushup</span>(u);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u]=k;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">change</span>(ls,l,mid,U,k);<br>	<span class="hljs-keyword">else</span> <span class="hljs-built_in">change</span>(rs,mid<span class="hljs-number">+1</span>,r,U,k);<br>	<span class="hljs-built_in">pushup</span>(u);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span></span>&#123;<br>	cin&gt;&gt;q&gt;&gt;MOD;<br>	<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,q);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=q;i++)&#123;<br>		<span class="hljs-type">int</span> op,x;<br>		cin&gt;&gt;op&gt;&gt;x;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<br>			x%=MOD;<br>			<span class="hljs-built_in">change</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,q,i,x);<br>			cout&lt;&lt;tr[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-built_in">change</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,q,x,<span class="hljs-number">1</span>);<br>			cout&lt;&lt;tr[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	<span class="hljs-type">int</span> T;<br>	cin&gt;&gt;T;<br>	<span class="hljs-keyword">while</span>(T--) <span class="hljs-built_in">solve</span>();<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4198">LuoguP4198</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m;<br><span class="hljs-type">double</span> a[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span>&#123;<br>	<span class="hljs-type">double</span> ma;<br>	<span class="hljs-type">int</span> len;<br>&#125;tr[<span class="hljs-number">4</span>*N];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup1</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	tr[u].ma=<span class="hljs-built_in">max</span>(tr[ls].ma,tr[rs].ma);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pushup2</span><span class="hljs-params">(<span class="hljs-type">double</span> lmax,<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(tr[u].ma&lt;=lmax) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span>(a[l]&gt;lmax) <span class="hljs-keyword">return</span> tr[u].len; <br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> a[l]&gt;lmax;<br>	<span class="hljs-keyword">if</span>(tr[ls].ma&lt;=lmax) <span class="hljs-keyword">return</span> <span class="hljs-built_in">pushup2</span>(lmax,rs,mid<span class="hljs-number">+1</span>,r);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">pushup2</span>(lmax,ls,l,mid)+tr[u].len-tr[ls].len;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U,<span class="hljs-type">int</span> c)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].ma=(<span class="hljs-type">double</span>)c/U;<br>		tr[u].len=<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">return</span> ;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">change</span>(ls,l,mid,U,c);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(U&gt;mid) <span class="hljs-built_in">change</span>(rs,mid<span class="hljs-number">+1</span>,r,U,c);<br>	<span class="hljs-built_in">pushup1</span>(u);<br>	tr[u].len=tr[ls].len+<span class="hljs-built_in">pushup2</span>(tr[ls].ma,rs,mid<span class="hljs-number">+1</span>,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-type">int</span> x,y;<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		cin&gt;&gt;x&gt;&gt;y;<br>		a[x]=(<span class="hljs-type">double</span>)y/x;<br>		<span class="hljs-built_in">change</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,x,y);<br>		cout&lt;&lt;tr[<span class="hljs-number">1</span>].len&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3870">LuoguP3870</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> tag,sum;<br>&#125;tr[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(!tr[u].tag) <span class="hljs-keyword">return</span>;<br>	tr[ls].tag^=<span class="hljs-number">1</span>;tr[rs].tag^=<span class="hljs-number">1</span>;<br>	tr[ls].sum=(mid-l<span class="hljs-number">+1</span>)-tr[ls].sum;<br>	tr[rs].sum=(r-mid)-tr[rs].sum;<br>	tr[u].tag=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<br>		tr[u].tag^=<span class="hljs-number">1</span>;<br>		tr[u].sum=(r-l<span class="hljs-number">+1</span>)-tr[u].sum;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-built_in">pushdown</span>(u,l,r);<br>	<span class="hljs-keyword">if</span>(L&lt;=mid) <span class="hljs-built_in">change</span>(ls,l,mid,L,R);<br>	<span class="hljs-keyword">if</span>(R&gt;mid) <span class="hljs-built_in">change</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R);<br>	tr[u].sum=tr[ls].sum+tr[rs].sum;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R) <span class="hljs-keyword">return</span> tr[u].sum;<br>	<span class="hljs-built_in">pushdown</span>(u,l,r);<br>	<span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span>(L&lt;=mid) res+=<span class="hljs-built_in">query</span>(ls,l,mid,L,R);<br>	<span class="hljs-keyword">if</span>(R&gt;mid) res+=<span class="hljs-built_in">query</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R);<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		<span class="hljs-type">int</span> c,a,b;<br>		cin&gt;&gt;c&gt;&gt;a&gt;&gt;b;<br>		<span class="hljs-keyword">if</span>(!c) <span class="hljs-built_in">change</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,a,b);<br>		<span class="hljs-keyword">else</span> cout&lt;&lt;<span class="hljs-built_in">query</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,a,b)&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP5490">LuoguP5490</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Line</span>&#123;<br>    <span class="hljs-type">int</span> x1,x2,y,k;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Line &amp;t) <span class="hljs-type">const</span>&#123;<br>        <span class="hljs-keyword">return</span> y&lt;t.y;<br>    &#125;<br>&#125;line[N&lt;&lt;<span class="hljs-number">1</span>];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>    <span class="hljs-type">int</span> cnt,len;<br>&#125;tr[N&lt;&lt;<span class="hljs-number">4</span>];<br><span class="hljs-type">int</span> n,X[N&lt;&lt;<span class="hljs-number">1</span>],p,ans;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(tr[u].cnt) tr[u].len=X[r]-X[l];<br>    <span class="hljs-keyword">else</span> tr[u].len=tr[ls].len+tr[rs].len;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<br>        tr[u].cnt+=k;<br>        <span class="hljs-built_in">pushup</span>(u,l,r);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(L&lt;mid) <span class="hljs-built_in">add</span>(ls,l,mid,L,R,k);<br>    <span class="hljs-keyword">if</span>(R&gt;mid) <span class="hljs-built_in">add</span>(rs,mid,r,L,R,k);<br>    <span class="hljs-built_in">pushup</span>(u,l,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;n;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-type">int</span> x1,y1,x2,y2;<br>        cin&gt;&gt;x1&gt;&gt;y1&gt;&gt;x2&gt;&gt;y2;<br>        line[i]=(Line)&#123;x1,x2,y1,<span class="hljs-number">1</span>&#125;;<br>        line[i+n]=(Line)&#123;x1,x2,y2,<span class="hljs-number">-1</span>&#125;;<br>        X[i]=x1,X[i+n]=x2;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(X<span class="hljs-number">+1</span>,X<span class="hljs-number">+2</span>*n<span class="hljs-number">+1</span>);<br>    <span class="hljs-built_in">sort</span>(line<span class="hljs-number">+1</span>,line<span class="hljs-number">+2</span>*n<span class="hljs-number">+1</span>);<br>    <span class="hljs-type">int</span> p=<span class="hljs-built_in">unique</span>(X<span class="hljs-number">+1</span>,X<span class="hljs-number">+2</span>*n<span class="hljs-number">+1</span>)-X<span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">2</span>*n;i++)&#123;<br>        line[i].x1=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+p<span class="hljs-number">+1</span>,line[i].x1)-X;<br>        line[i].x2=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+p<span class="hljs-number">+1</span>,line[i].x2)-X;<br>        ans+=tr[<span class="hljs-number">1</span>].len*(line[i].y-line[i<span class="hljs-number">-1</span>].y);<br>        <span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,p,line[i].x1,line[i].x2,line[i].k);<br>    &#125;<br>    cout&lt;&lt;ans;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP1502">LuoguP1502</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,w,h,X[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Line</span>&#123;<br>	<span class="hljs-type">int</span> l,r,h,w;<br>	<span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Line &amp;a)<span class="hljs-type">const</span>&#123;<br>		<span class="hljs-keyword">return</span> h!=a.h?h&lt;a.h:w&gt;a.w;<br>	&#125;<br>&#125;line[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> l,r,mx,add;<br>&#125;tr[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	tr[u].mx=<span class="hljs-built_in">max</span>(tr[ls].mx,tr[rs].mx);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	tr[u].l=l,tr[u].r=r,tr[u].mx=tr[u].add=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-built_in">build</span>(ls,l,mid);<br>	<span class="hljs-built_in">build</span>(rs,mid<span class="hljs-number">+1</span>,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	tr[ls].mx+=tr[u].add;<br>	tr[rs].mx+=tr[u].add;<br>	tr[ls].add+=tr[u].add;<br>	tr[rs].add+=tr[u].add;<br>	tr[u].add=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-type">int</span> l=tr[u].l,r=tr[u].r;<br>	<span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<br>		tr[u].mx+=k;<br>		tr[u].add+=k;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-built_in">pushdown</span>(u);<br>	<span class="hljs-keyword">if</span>(L&lt;=mid) <span class="hljs-built_in">change</span>(ls,L,R,k);<br>	<span class="hljs-keyword">if</span>(R&gt;mid) <span class="hljs-built_in">change</span>(rs,L,R,k);<br>	<span class="hljs-built_in">pushup</span>(u);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span></span>&#123;<br>	cin&gt;&gt;n&gt;&gt;w&gt;&gt;h;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-type">int</span> x,y,l;<br>		cin&gt;&gt;x&gt;&gt;y&gt;&gt;l;<br>		<span class="hljs-type">int</span> x1=x+w<span class="hljs-number">-1</span>,y1=y+h<span class="hljs-number">-1</span>;<br>		X[(i&lt;&lt;<span class="hljs-number">1</span>)<span class="hljs-number">-1</span>]=y;<br>		X[i&lt;&lt;<span class="hljs-number">1</span>]=y+h<span class="hljs-number">-1</span>;<br>		line[(i&lt;&lt;<span class="hljs-number">1</span>)<span class="hljs-number">-1</span>]=(Line)&#123;y,y1,x,l&#125;;<br>		line[i&lt;&lt;<span class="hljs-number">1</span>]=(Line)&#123;y,y1,x1,-l&#125;;	<br>	&#125;<br>	n&lt;&lt;=<span class="hljs-number">1</span>;<br>	<span class="hljs-built_in">sort</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>);<br>	<span class="hljs-built_in">sort</span>(line<span class="hljs-number">+1</span>,line+n<span class="hljs-number">+1</span>);<br>	<span class="hljs-type">int</span> cnt=<span class="hljs-built_in">unique</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>)-X<span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		line[i].l=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+cnt<span class="hljs-number">+1</span>,line[i].l)-X;<br>		line[i].r=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+cnt<span class="hljs-number">+1</span>,line[i].r)-X;<br>	&#125;<br>	<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,cnt);<br>	<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-built_in">change</span>(<span class="hljs-number">1</span>,line[i].l,line[i].r,line[i].w);<br>		ans=<span class="hljs-built_in">max</span>(ans,tr[<span class="hljs-number">1</span>].mx);<br>	&#125;<br>	cout&lt;&lt;ans&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	<span class="hljs-type">int</span> T;<br>	cin&gt;&gt;T;<br>	<span class="hljs-keyword">while</span>(T--) <span class="hljs-built_in">solve</span>();<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4097">LuoguP4097</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pii pair<span class="hljs-string">&lt;double,int&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> M=<span class="hljs-number">39990</span>,N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">double</span> eps=<span class="hljs-number">1e-10</span>;<br><span class="hljs-type">int</span> n,lst,cnt,id[M&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Line</span>&#123;<br>	<span class="hljs-type">double</span> k,b;<br>	<span class="hljs-type">int</span> xmi,xma;<br>	<span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">q</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>		<span class="hljs-keyword">if</span>(xmi&lt;=x&amp;&amp;x&lt;=xma) <span class="hljs-keyword">return</span> k*x+b;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-number">-1e9</span>;<br>	&#125;<br>&#125;f[N];<br>pii _max(pii a,pii b)&#123;<br>	<span class="hljs-keyword">if</span>(a.first-b.first&gt;eps) <span class="hljs-keyword">return</span> a;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(b.first-a.first&gt;eps) <span class="hljs-keyword">return</span> b;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> a.second&lt;b.second?a:b;<br>&#125;<br><span class="hljs-function">pii <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	pii res;<br>	<span class="hljs-keyword">if</span>(id[u]) res=&#123;f[id[u]].<span class="hljs-built_in">q</span>(k),id[u]&#125;;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> res;<br>	<span class="hljs-keyword">if</span>(k&lt;=mid) res=_max(<span class="hljs-built_in">query</span>(ls,l,mid,k),res);<br>	<span class="hljs-keyword">else</span> res=_max(<span class="hljs-built_in">query</span>(rs,mid<span class="hljs-number">+1</span>,r,k),res);<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-comment">//cerr&lt;&lt;u&lt;&lt;&#x27; &#x27;&lt;&lt;l&lt;&lt;&#x27; &#x27;&lt;&lt;r&lt;&lt;&#x27;\n&#x27;;</span><br>	<span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<br>		<span class="hljs-keyword">if</span>(!id[u]) <span class="hljs-keyword">return</span> id[u]=k,<span class="hljs-built_in">void</span>();<span class="hljs-comment">//还没有过</span><br>		<span class="hljs-keyword">if</span>(f[k].<span class="hljs-built_in">q</span>(mid)-f[id[u]].<span class="hljs-built_in">q</span>(mid)&gt;eps) <span class="hljs-built_in">swap</span>(k,id[u]);<br>		<span class="hljs-keyword">if</span>(f[k].<span class="hljs-built_in">q</span>(l)-f[id[u]].<span class="hljs-built_in">q</span>(l)&gt;eps||(f[k].<span class="hljs-built_in">q</span>(l)==f[id[u]].<span class="hljs-built_in">q</span>(l)&amp;&amp;k&lt;id[u])) <span class="hljs-built_in">update</span>(ls,l,mid,L,R,k);<br>		<span class="hljs-keyword">if</span>(f[k].<span class="hljs-built_in">q</span>(r)-f[id[u]].<span class="hljs-built_in">q</span>(r)&gt;eps||(f[k].<span class="hljs-built_in">q</span>(r)==f[id[u]].<span class="hljs-built_in">q</span>(r)&amp;&amp;k&lt;id[u])) <span class="hljs-built_in">update</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R,k);<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(L&lt;=mid) <span class="hljs-built_in">update</span>(ls,l,mid,L,R,k);<br>	<span class="hljs-keyword">if</span>(R&gt;mid) <span class="hljs-built_in">update</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R,k);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	<span class="hljs-comment">//freopen(&quot;P4097_8.in&quot;,&quot;r&quot;,stdin);</span><br>	<span class="hljs-comment">//freopen(&quot;1.out&quot;,&quot;w&quot;,stdout);</span><br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		<span class="hljs-type">int</span> op;<br>		cin&gt;&gt;op;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">0</span>)&#123;<br>			<span class="hljs-type">int</span> k;<br>			cin&gt;&gt;k;k=(k+lst<span class="hljs-number">-1</span>)%<span class="hljs-number">39989</span><span class="hljs-number">+1</span>;<br>			cout&lt;&lt;(lst=<span class="hljs-built_in">query</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,M,k).second)&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-type">int</span> x0,y0,x1,y1;<br>			cin&gt;&gt;x0&gt;&gt;y0&gt;&gt;x1&gt;&gt;y1;<br>			x0=(x0+lst<span class="hljs-number">-1</span>)%<span class="hljs-number">39989</span><span class="hljs-number">+1</span>;x1=(x1+lst<span class="hljs-number">-1</span>)%<span class="hljs-number">39989</span><span class="hljs-number">+1</span>;<br>			y0=(y0+lst<span class="hljs-number">-1</span>)%(<span class="hljs-type">int</span>)<span class="hljs-number">1e9</span><span class="hljs-number">+1</span>;y1=(y1+lst<span class="hljs-number">-1</span>)%(<span class="hljs-type">int</span>)<span class="hljs-number">1e9</span><span class="hljs-number">+1</span>;<br>			cnt++;<br>			<span class="hljs-keyword">if</span>(x0==x1)&#123;<br>				f[cnt].k=<span class="hljs-number">0</span>;<br>				f[cnt].b=<span class="hljs-built_in">max</span>(y1,y0);<br>				f[cnt].xmi=f[cnt].xma=x0;<br>			&#125;<span class="hljs-keyword">else</span>&#123;<br>				f[cnt].k=<span class="hljs-number">1.0</span>*(<span class="hljs-number">1.0</span>*y1-y0)/(<span class="hljs-number">1.0</span>*x1-x0);<br>				f[cnt].b=<span class="hljs-number">1.0</span>*(<span class="hljs-number">1.0</span>*y1-f[cnt].k*x1);<br>				<span class="hljs-keyword">if</span>(x0&gt;x1) <span class="hljs-built_in">swap</span>(x0,x1);<br>				f[cnt].xmi=x0;<br>				f[cnt].xma=x1;<br>			&#125;<br>			<span class="hljs-built_in">update</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,M,x0,x1,cnt);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4556">LuoguP4556</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,fa[N][<span class="hljs-number">30</span>],dep[N],tot,lg[N];<br>vector&lt;vector&lt;<span class="hljs-type">int</span>&gt; &gt; <span class="hljs-built_in">tree</span>(N);<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> u,cnt;<br>    <span class="hljs-keyword">friend</span> <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (Node a,Node b)&#123;<span class="hljs-keyword">return</span> (a.cnt==b.cnt)?a.u&gt;b.u:a.cnt&lt;b.cnt;&#125;<br>    <span class="hljs-keyword">friend</span> Node <span class="hljs-keyword">operator</span> + (Node a,Node b)&#123;<span class="hljs-keyword">return</span> (Node)&#123;a.u,a.cnt+b.cnt&#125;;&#125;<br>&#125;;<br>vector&lt;vector&lt;Node&gt; &gt; <span class="hljs-built_in">op</span>(N);<br><span class="hljs-type">int</span> s[N&lt;&lt;<span class="hljs-number">5</span>][<span class="hljs-number">2</span>];<br>Node ma[N&lt;&lt;<span class="hljs-number">5</span>]; <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-type">int</span> p1,<span class="hljs-type">int</span> p2,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		ma[p1]=ma[p1]+ma[p2];<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(s[p1][<span class="hljs-number">0</span>]&amp;&amp;s[p2][<span class="hljs-number">0</span>]) <span class="hljs-built_in">merge</span>(s[p1][<span class="hljs-number">0</span>],s[p2][<span class="hljs-number">0</span>],l,mid);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(s[p2][<span class="hljs-number">0</span>]) s[p1][<span class="hljs-number">0</span>]=s[p2][<span class="hljs-number">0</span>];<br>	<span class="hljs-keyword">if</span>(s[p1][<span class="hljs-number">1</span>]&amp;&amp;s[p2][<span class="hljs-number">1</span>]) <span class="hljs-built_in">merge</span>(s[p1][<span class="hljs-number">1</span>],s[p2][<span class="hljs-number">1</span>],mid<span class="hljs-number">+1</span>,r);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(s[p2][<span class="hljs-number">1</span>]) s[p1][<span class="hljs-number">1</span>]=s[p2][<span class="hljs-number">1</span>];<br>	ma[p1]=<span class="hljs-built_in">max</span>(ma[s[p1][<span class="hljs-number">0</span>]],ma[s[p1][<span class="hljs-number">1</span>]]);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,Node k)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		ma[u]=k+ma[u];<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(k.u&lt;=mid) <span class="hljs-built_in">insert</span>(s[u][<span class="hljs-number">0</span>]=(s[u][<span class="hljs-number">0</span>]?s[u][<span class="hljs-number">0</span>]:++tot),l,mid,k);<br>	<span class="hljs-keyword">if</span>(k.u&gt;mid) <span class="hljs-built_in">insert</span>(s[u][<span class="hljs-number">1</span>]=(s[u][<span class="hljs-number">1</span>]?s[u][<span class="hljs-number">1</span>]:++tot),mid<span class="hljs-number">+1</span>,r,k);<br>	ma[u]=<span class="hljs-built_in">max</span>(ma[s[u][<span class="hljs-number">0</span>]],ma[s[u][<span class="hljs-number">1</span>]]);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build_tree</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	dep[u]=dep[fa[u][<span class="hljs-number">0</span>]]<span class="hljs-number">+1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=lg[dep[u]];i++) fa[u][i]=fa[fa[u][i<span class="hljs-number">-1</span>]][i<span class="hljs-number">-1</span>];<br>	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:tree[u])&#123;<br>		<span class="hljs-keyword">if</span>(it!=fa[u][<span class="hljs-number">0</span>])&#123;<br>			fa[it][<span class="hljs-number">0</span>]=u;<br>			<span class="hljs-built_in">build_tree</span>(it);<br>		&#125;<br>	&#125; <br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get_lca</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(dep[x]&lt;dep[y]) <span class="hljs-built_in">swap</span>(x,y);<br>	<span class="hljs-keyword">while</span>(dep[x]&gt;dep[y]) x=fa[x][lg[dep[x]-dep[y]]];<br>	<span class="hljs-keyword">if</span>(x==y) <span class="hljs-keyword">return</span> x;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=lg[dep[x]];i&gt;=<span class="hljs-number">0</span>;i--)&#123;<br>		<span class="hljs-keyword">if</span>(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];<br>	&#125;<br>	<span class="hljs-keyword">return</span> fa[x][<span class="hljs-number">0</span>];<br>&#125;<br><span class="hljs-type">int</span> ans[N];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge_tree</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:tree[u])&#123;<br>		<span class="hljs-keyword">if</span>(it!=fa[u][<span class="hljs-number">0</span>])&#123;<br>			<span class="hljs-built_in">merge_tree</span>(it); <br>			<span class="hljs-built_in">merge</span>(u,it,<span class="hljs-number">0</span>,N);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:op[u]) <span class="hljs-built_in">insert</span>(u,<span class="hljs-number">0</span>,N,it);<br>	ans[u]=ma[u].u;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	lg[<span class="hljs-number">0</span>]=<span class="hljs-number">-1</span>;tot=n;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++)&#123;<br>		<span class="hljs-type">int</span> a,b;<br>		cin&gt;&gt;a&gt;&gt;b;<br>		tree[a].<span class="hljs-built_in">push_back</span>(b);<br>		tree[b].<span class="hljs-built_in">push_back</span>(a);<br>		lg[i]=lg[i&gt;&gt;<span class="hljs-number">1</span>]<span class="hljs-number">+1</span>;<br>	&#125;<br>	<span class="hljs-built_in">build_tree</span>(<span class="hljs-number">1</span>);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>		<span class="hljs-type">int</span> x,y,z;<br>		cin&gt;&gt;x&gt;&gt;y&gt;&gt;z;<br>		<span class="hljs-type">int</span> lca=<span class="hljs-built_in">get_lca</span>(x,y);<br>		op[x].<span class="hljs-built_in">push_back</span>((Node)&#123;z,<span class="hljs-number">1</span>&#125;);<br>		op[y].<span class="hljs-built_in">push_back</span>((Node)&#123;z,<span class="hljs-number">1</span>&#125;);<br>		op[lca].<span class="hljs-built_in">push_back</span>((Node)&#123;z,<span class="hljs-number">-1</span>&#125;);<br>		op[fa[lca][<span class="hljs-number">0</span>]].<span class="hljs-built_in">push_back</span>((Node)&#123;z,<span class="hljs-number">-1</span>&#125;);<br>	&#125;<br>	<span class="hljs-built_in">merge_tree</span>(<span class="hljs-number">1</span>);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cout&lt;&lt;ans[i]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3919">LuoguP3919</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e6</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,a[N],root[N],tot;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> ls,rs,val;<br>&#125;tr[N&lt;&lt;<span class="hljs-number">5</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	u=++tot;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].val=a[l];<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-built_in">build</span>(tr[u].ls,l,mid);<br>	<span class="hljs-built_in">build</span>(tr[u].rs,mid<span class="hljs-number">+1</span>,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	tr[++tot]=tr[u]; u=tot;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].val=k;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">change</span>(tr[u].ls,l,mid,U,k);<br>	<span class="hljs-keyword">else</span> <span class="hljs-built_in">change</span>(tr[u].rs,mid<span class="hljs-number">+1</span>,r,U,k);<br>	<span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> tr[u].val;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(tr[u].ls,l,mid,U);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(tr[u].rs,mid<span class="hljs-number">+1</span>,r,U);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;a[i];<br>	<span class="hljs-built_in">build</span>(root[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>,n);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>		<span class="hljs-type">int</span> v,op,loc,val;<br>		cin&gt;&gt;v&gt;&gt;op&gt;&gt;loc;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<br>			cin&gt;&gt;val;<br>			root[i]=root[v];<br>			<span class="hljs-built_in">change</span>(root[i],<span class="hljs-number">1</span>,n,loc,val);<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			cout&lt;&lt;<span class="hljs-built_in">query</span>(root[v],<span class="hljs-number">1</span>,n,loc)&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>			root[i]=root[v];<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3402">LuoguP3402</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,ti;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Tree</span>&#123;<br>	<span class="hljs-type">int</span> root[N],st[N],ls[N&lt;&lt;<span class="hljs-number">5</span>],rs[N&lt;&lt;<span class="hljs-number">5</span>],val[N&lt;&lt;<span class="hljs-number">5</span>],tot;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;rt,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>		rt=++tot;<br>		<span class="hljs-keyword">if</span>(l==r)&#123;<br>			val[rt]=st[l];<br>			<span class="hljs-keyword">return</span>;<br>		&#125;<br>		<span class="hljs-built_in">build</span>(ls[rt],l,mid);<br>		<span class="hljs-built_in">build</span>(rs[rt],mid<span class="hljs-number">+1</span>,r);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">upload</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;rt,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U,<span class="hljs-type">int</span> k)</span></span>&#123;<br>		<span class="hljs-type">int</span> kk=rt;<br>		rt=++tot;<br>		ls[rt]=ls[kk];<br>		rs[rt]=rs[kk];<br>		<span class="hljs-keyword">if</span>(l==r)&#123;<br>			val[rt]=k;<br>			<span class="hljs-keyword">return</span>;<br>		&#125;<br>		<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">upload</span>(ls[rt],l,mid,U,k);<br>		<span class="hljs-keyword">else</span> <span class="hljs-built_in">upload</span>(rs[rt],mid<span class="hljs-number">+1</span>,r,U,k);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> rt,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U)</span></span>&#123;<br>		<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> val[rt];<br>		<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(ls[rt],l,mid,U);<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(rs[rt],mid<span class="hljs-number">+1</span>,r,U);<br>	&#125;<br>&#125;bin,siz;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>	<span class="hljs-keyword">while</span>(bin.<span class="hljs-built_in">query</span>(bin.root[ti],<span class="hljs-number">1</span>,n,x)!=x) x=bin.<span class="hljs-built_in">query</span>(bin.root[ti],<span class="hljs-number">1</span>,n,x);<br>	<span class="hljs-keyword">return</span> x;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>	<span class="hljs-type">int</span> fx=<span class="hljs-built_in">find</span>(x);<br>	<span class="hljs-type">int</span> fy=<span class="hljs-built_in">find</span>(y);<br>	<span class="hljs-keyword">if</span>(fx==fy) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-type">int</span> sizx=siz.<span class="hljs-built_in">query</span>(siz.root[ti],<span class="hljs-number">1</span>,n,fx),sizy=siz.<span class="hljs-built_in">query</span>(siz.root[ti],<span class="hljs-number">1</span>,n,fy);<br>	<span class="hljs-keyword">if</span>(sizx&lt;=sizy)&#123;<br>		bin.<span class="hljs-built_in">upload</span>(bin.root[ti],<span class="hljs-number">1</span>,n,fx,fy);<br>		siz.<span class="hljs-built_in">upload</span>(siz.root[ti],<span class="hljs-number">1</span>,n,fy,sizx+sizy);<br>	&#125;<br>	<span class="hljs-keyword">else</span>&#123;<br>		bin.<span class="hljs-built_in">upload</span>(bin.root[ti],<span class="hljs-number">1</span>,n,fy,fx);<br>		siz.<span class="hljs-built_in">upload</span>(siz.root[ti],<span class="hljs-number">1</span>,n,fx,sizx+sizy);<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>;i &lt;= n;i++) bin.st[i]=i,siz.st[i]=<span class="hljs-number">1</span>;<br>	bin.<span class="hljs-built_in">build</span>(bin.root[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>,n);<br>	siz.<span class="hljs-built_in">build</span>(siz.root[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>,n);<br>	<span class="hljs-keyword">for</span>(ti=<span class="hljs-number">1</span>;ti&lt;=m;ti++)&#123;<br>		<span class="hljs-type">int</span> opt,x,y;<br>		cin&gt;&gt;opt;<br>		bin.root[ti]=bin.root[ti<span class="hljs-number">-1</span>];<br>		siz.root[ti]=siz.root[ti<span class="hljs-number">-1</span>];<br>		<span class="hljs-keyword">if</span>(opt==<span class="hljs-number">1</span>)&#123;<br>			cin&gt;&gt;x&gt;&gt;y;<br>			<span class="hljs-built_in">merge</span>(x,y);<br>		&#125;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(opt == <span class="hljs-number">2</span>)&#123;<br>			cin&gt;&gt;x;<br>			bin.root[ti]=bin.root[x];<br>			siz.root[ti]=siz.root[x];<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			cin&gt;&gt;x&gt;&gt;y;<br>			cout&lt;&lt;(<span class="hljs-built_in">find</span>(x) == <span class="hljs-built_in">find</span>(y))&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3834">LuoguP3834</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,x,root[N],tot,a[N],p,X[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<span class="hljs-type">int</span> ls,rs,cnt;&#125;tr[N&lt;&lt;<span class="hljs-number">5</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	u=++tot;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-built_in">build</span>(tr[u].ls,l,mid);<br>	<span class="hljs-built_in">build</span>(tr[u].rs,mid<span class="hljs-number">+1</span>,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U)</span></span>&#123;<br>	tr[++tot]=tr[u];<br>	u=tot;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].cnt++;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">change</span>(tr[u].ls,l,mid,U);<br>	<span class="hljs-keyword">else</span> <span class="hljs-built_in">change</span>(tr[u].rs,mid<span class="hljs-number">+1</span>,r,U);<br>	tr[u].cnt=tr[tr[u].ls].cnt+tr[tr[u].rs].cnt;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> l;<br>	<span class="hljs-type">int</span> s=tr[tr[u].ls].cnt-tr[tr[v].ls].cnt;<br>	<span class="hljs-comment">//cerr&lt;&lt;s&lt;&lt;endl;</span><br>	<span class="hljs-keyword">if</span>(s&gt;=k) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(tr[u].ls,tr[v].ls,l,mid,k);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(tr[u].rs,tr[v].rs,mid<span class="hljs-number">+1</span>,r,k-s);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-comment">//cout&lt;&lt;l&lt;&lt;&#x27; &#x27;&lt;&lt;r&lt;&lt;&#x27; &#x27;&lt;&lt;tr[u].cnt&lt;&lt;&#x27;\n&#x27;;</span><br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-keyword">if</span>(tr[u].ls) <span class="hljs-built_in">print</span>(tr[u].ls,l,mid);<br>	<span class="hljs-keyword">if</span>(tr[u].rs) <span class="hljs-built_in">print</span>(tr[u].rs,mid<span class="hljs-number">+1</span>,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		cin&gt;&gt;a[i];<br>		X[i]=a[i];<br>	&#125;<br>	<span class="hljs-built_in">sort</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>);<br>	p=<span class="hljs-built_in">unique</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>)-X<span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) a[i]=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+p<span class="hljs-number">+1</span>,a[i])-X;<br>	<span class="hljs-built_in">build</span>(root[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>,p);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		root[i]=root[i<span class="hljs-number">-1</span>];<br>		<span class="hljs-built_in">change</span>(root[i],<span class="hljs-number">1</span>,p,a[i]);<br>	&#125;<br>	<span class="hljs-comment">//print(root[n],1,p);</span><br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		<span class="hljs-type">int</span> l,r,k;<br>		cin&gt;&gt;l&gt;&gt;r&gt;&gt;k;<br>		cout&lt;&lt;X[<span class="hljs-built_in">query</span>(root[r],root[l<span class="hljs-number">-1</span>],<span class="hljs-number">1</span>,p,k)]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP2633">LuoguP2633</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(x) (tr[x].ls)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(x) (tr[x].rs)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fa(x) (f[x][0])</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,a[N],X[N],dep[N],f[N][<span class="hljs-number">20</span>],lg[N],root[N],p,tot,lst;<br>vector&lt;vector&lt;<span class="hljs-type">int</span>&gt; &gt; <span class="hljs-built_in">v</span>(N);<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> ls,rs,cnt;<br>&#125;tr[N&lt;&lt;<span class="hljs-number">5</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	u=++tot;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-built_in">build</span>(<span class="hljs-built_in">ls</span>(u),l,mid);<br>	<span class="hljs-built_in">build</span>(<span class="hljs-built_in">rs</span>(u),mid<span class="hljs-number">+1</span>,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U)</span></span>&#123;<br>	tr[++tot]=tr[u];<br>	u=tot;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].cnt++;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">change</span>(<span class="hljs-built_in">ls</span>(u),l,mid,U);<br>	<span class="hljs-keyword">else</span> <span class="hljs-built_in">change</span>(<span class="hljs-built_in">rs</span>(u),mid<span class="hljs-number">+1</span>,r,U);<br>	tr[u].cnt=tr[<span class="hljs-built_in">ls</span>(u)].cnt+tr[<span class="hljs-built_in">rs</span>(u)].cnt;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build_tree</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	dep[u]=dep[<span class="hljs-built_in">fa</span>(u)]<span class="hljs-number">+1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=lg[dep[u]];i++) f[u][i]=f[f[u][i<span class="hljs-number">-1</span>]][i<span class="hljs-number">-1</span>];<br>	root[u]=root[<span class="hljs-built_in">fa</span>(u)];<br>	<span class="hljs-built_in">change</span>(root[u],<span class="hljs-number">1</span>,p,a[u]);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:v[u])&#123;<br>		<span class="hljs-keyword">if</span>(it!=<span class="hljs-built_in">fa</span>(u))&#123;<br>			f[it][<span class="hljs-number">0</span>]=u;<br>			<span class="hljs-built_in">build_tree</span>(it);<br>		&#125;<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get_lca</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(dep[u]&lt;dep[v]) <span class="hljs-built_in">swap</span>(u,v);<br>	<span class="hljs-keyword">while</span>(dep[u]&gt;dep[v]) u=f[u][lg[dep[u]-dep[v]]];<br>	<span class="hljs-keyword">if</span>(u==v) <span class="hljs-keyword">return</span> u;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=lg[dep[u]];i&gt;=<span class="hljs-number">0</span>;i--)&#123;<br>		<span class="hljs-keyword">if</span>(f[u][i]!=f[v][i]) u=f[u][i],v=f[v][i];<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-built_in">fa</span>(u);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> w,<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y,<span class="hljs-type">int</span> z,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> l;<br>	<span class="hljs-type">int</span> s=tr[<span class="hljs-built_in">ls</span>(w)].cnt+tr[<span class="hljs-built_in">ls</span>(x)].cnt-tr[<span class="hljs-built_in">ls</span>(y)].cnt-tr[<span class="hljs-built_in">ls</span>(z)].cnt;<br>	<span class="hljs-keyword">if</span>(s&gt;=k) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(<span class="hljs-built_in">ls</span>(w),<span class="hljs-built_in">ls</span>(x),<span class="hljs-built_in">ls</span>(y),<span class="hljs-built_in">ls</span>(z),l,mid,k);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(<span class="hljs-built_in">rs</span>(w),<span class="hljs-built_in">rs</span>(x),<span class="hljs-built_in">rs</span>(y),<span class="hljs-built_in">rs</span>(z),mid<span class="hljs-number">+1</span>,r,k-s);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	lg[<span class="hljs-number">0</span>]=<span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		cin&gt;&gt;a[i];<br>		X[i]=a[i];<br>		lg[i]=lg[i&gt;&gt;<span class="hljs-number">1</span>]<span class="hljs-number">+1</span>;<br>	&#125;<br>	<span class="hljs-built_in">sort</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>);<br>	p=<span class="hljs-built_in">unique</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>)-X<span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) a[i]=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+p<span class="hljs-number">+1</span>,a[i])-X;<br>	<span class="hljs-built_in">build</span>(root[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>,p);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;n;i++)&#123;<br>		<span class="hljs-type">int</span> x,y;<br>		cin&gt;&gt;x&gt;&gt;y;<br>		v[x].<span class="hljs-built_in">push_back</span>(y);v[y].<span class="hljs-built_in">push_back</span>(x);<br>	&#125;<br>	<span class="hljs-built_in">build_tree</span>(<span class="hljs-number">1</span>);<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		<span class="hljs-type">int</span> u,v,k;<br>		cin&gt;&gt;u&gt;&gt;v&gt;&gt;k;<br>		u^=lst;<br>		<span class="hljs-type">int</span> lca=<span class="hljs-built_in">get_lca</span>(u,v);<br>		lst=X[<span class="hljs-built_in">query</span>(root[u],root[v],root[lca],root[<span class="hljs-built_in">fa</span>(lca)],<span class="hljs-number">1</span>,p,k)];<br>		cout&lt;&lt;lst&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3302">LuoguP3302</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(x) tr[x].ls</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(x) tr[x].rs</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">8e4</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,t,val[N],root[N],fa[N][<span class="hljs-number">18</span>],lg[N],dep[N],X[N],p,tot,siz[N];<br><span class="hljs-type">bool</span> vis[N];<br>vector&lt;vector&lt;<span class="hljs-type">int</span>&gt; &gt; <span class="hljs-built_in">v</span>(N);<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Tree</span>&#123;<br>    <span class="hljs-type">int</span> ls,rs,cnt;<br>&#125;tr[N*<span class="hljs-number">600</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    tr[++tot]=tr[u];<br>    u=tot;<br>    <span class="hljs-keyword">if</span>(l==r)&#123;<br>        tr[u].cnt++;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(k&lt;=mid) <span class="hljs-built_in">change</span>(<span class="hljs-built_in">ls</span>(u),l,mid,k);<br>    <span class="hljs-keyword">else</span> <span class="hljs-built_in">change</span>(<span class="hljs-built_in">rs</span>(u),mid<span class="hljs-number">+1</span>,r,k);<br>    tr[u].cnt=tr[<span class="hljs-built_in">ls</span>(u)].cnt+tr[<span class="hljs-built_in">rs</span>(u)].cnt;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>    vis[u]=<span class="hljs-number">1</span>;<br>    siz[u]=<span class="hljs-number">1</span>;<br>    dep[u]=dep[fa[u][<span class="hljs-number">0</span>]]<span class="hljs-number">+1</span>;<br>    root[u]=root[fa[u][<span class="hljs-number">0</span>]];<br>    <span class="hljs-built_in">change</span>(root[u],<span class="hljs-number">1</span>,p,val[u]);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">17</span>;i++) fa[u][i]=fa[fa[u][i<span class="hljs-number">-1</span>]][i<span class="hljs-number">-1</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it:v[u])&#123;<br>        <span class="hljs-keyword">if</span>(it==fa[u][<span class="hljs-number">0</span>]) <span class="hljs-keyword">continue</span>;<br>        fa[it][<span class="hljs-number">0</span>]=u;<br>        <span class="hljs-built_in">dfs</span>(it);<br>        siz[u]+=siz[it];<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>    u=++tot;<br>    <span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-built_in">build</span>(<span class="hljs-built_in">ls</span>(u),l,mid);<br>    <span class="hljs-built_in">build</span>(<span class="hljs-built_in">rs</span>(u),mid<span class="hljs-number">+1</span>,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find_lca</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(dep[x]&lt;dep[y]) <span class="hljs-built_in">swap</span>(x,y);<br>    <span class="hljs-keyword">while</span>(dep[x]&gt;dep[y]) x=fa[x][lg[dep[x]-dep[y]]];<br>    <span class="hljs-keyword">if</span>(x==y) <span class="hljs-keyword">return</span> x;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=lg[dep[x]];i&gt;=<span class="hljs-number">0</span>;i--)&#123;<br>        <span class="hljs-keyword">if</span>(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];<br>    &#125;<br>    <span class="hljs-keyword">return</span> fa[x][<span class="hljs-number">0</span>];<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y,<span class="hljs-type">int</span> z,<span class="hljs-type">int</span> w,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> l;<br>    <span class="hljs-type">int</span> s=tr[<span class="hljs-built_in">ls</span>(x)].cnt+tr[<span class="hljs-built_in">ls</span>(y)].cnt-tr[<span class="hljs-built_in">ls</span>(z)].cnt-tr[<span class="hljs-built_in">ls</span>(w)].cnt;<br>    <span class="hljs-keyword">if</span>(s&gt;=k) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(<span class="hljs-built_in">ls</span>(x),<span class="hljs-built_in">ls</span>(y),<span class="hljs-built_in">ls</span>(z),<span class="hljs-built_in">ls</span>(w),l,mid,k);<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(<span class="hljs-built_in">rs</span>(x),<span class="hljs-built_in">rs</span>(y),<span class="hljs-built_in">rs</span>(z),<span class="hljs-built_in">rs</span>(w),mid<span class="hljs-number">+1</span>,r,k-s);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;n&gt;&gt;n&gt;&gt;m&gt;&gt;t;<br>    lg[<span class="hljs-number">0</span>]=<span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        cin&gt;&gt;val[i];<br>        lg[i]=lg[i&gt;&gt;<span class="hljs-number">1</span>]<span class="hljs-number">+1</span>;<br>        X[i]=val[i];<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>);<br>    p=<span class="hljs-built_in">unique</span>(X<span class="hljs-number">+1</span>,X+n<span class="hljs-number">+1</span>)-X<span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) val[i]=<span class="hljs-built_in">lower_bound</span>(X<span class="hljs-number">+1</span>,X+p<span class="hljs-number">+1</span>,val[i])-X;<br>    <span class="hljs-keyword">while</span>(m--)&#123;<br>        <span class="hljs-type">int</span> x,y;<br>        cin&gt;&gt;x&gt;&gt;y;<br>        v[x].<span class="hljs-built_in">push_back</span>(y);<br>        v[y].<span class="hljs-built_in">push_back</span>(x);<br>    &#125;<br>    <span class="hljs-built_in">build</span>(root[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>,p);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-keyword">if</span>(!vis[i]) <span class="hljs-built_in">dfs</span>(i);<br>    &#125;<br>    <span class="hljs-type">int</span> lst=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(t--)&#123;<br>        <span class="hljs-type">char</span> op;<span class="hljs-type">int</span> x,y,k;<br>        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;<br>        x^=lst,y^=lst;<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-string">&#x27;Q&#x27;</span>)&#123;<br>            cin&gt;&gt;k;k^=lst;<br>            <span class="hljs-type">int</span> lca=<span class="hljs-built_in">find_lca</span>(x,y);<br>            <span class="hljs-comment">//cerr&lt;&lt;query(root[x],root[y],root[lca],root[fa[lca][0]],1,p,k)&lt;&lt;&#x27;\n&#x27;;</span><br>            lst=X[<span class="hljs-built_in">query</span>(root[x],root[y],root[lca],root[fa[lca][<span class="hljs-number">0</span>]],<span class="hljs-number">1</span>,p,k)];<br>            cout&lt;&lt;lst&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">if</span>(siz[x]&lt;siz[y]) <span class="hljs-built_in">swap</span>(x,y);<br>            v[x].<span class="hljs-built_in">push_back</span>(y),v[y].<span class="hljs-built_in">push_back</span>(x);<br>            siz[x]+=siz[y];fa[y][<span class="hljs-number">0</span>]=x;<br>            <span class="hljs-built_in">dfs</span>(y);<br>        &#125;<br>    &#125;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4148">LuoguP4148</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(x) tr[x].ls</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(x) tr[x].rs</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,rt;<br><span class="hljs-type">int</span> top,rub[N],tot;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span>&#123;<span class="hljs-type">int</span> pos[<span class="hljs-number">2</span>],w;&#125;p[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>    <span class="hljs-type">int</span> mi[<span class="hljs-number">2</span>],ma[<span class="hljs-number">2</span>],sum,ls,rs,siz;<br>    Point tp;<br>&#125;tr[N];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">newnode</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(top) <span class="hljs-keyword">return</span> rub[top--];<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> ++tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">1</span>;i++)&#123;<br>        tr[u].mi[i]=tr[u].ma[i]=tr[u].tp.pos[i];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(u)) tr[u].ma[i]=<span class="hljs-built_in">max</span>(tr[u].ma[i],tr[<span class="hljs-built_in">ls</span>(u)].ma[i]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(u)) tr[u].ma[i]=<span class="hljs-built_in">max</span>(tr[u].ma[i],tr[<span class="hljs-built_in">rs</span>(u)].ma[i]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(u)) tr[u].mi[i]=<span class="hljs-built_in">min</span>(tr[u].mi[i],tr[<span class="hljs-built_in">ls</span>(u)].mi[i]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(u)) tr[u].mi[i]=<span class="hljs-built_in">min</span>(tr[u].mi[i],tr[<span class="hljs-built_in">rs</span>(u)].mi[i]);        <br>    &#125;<br>    tr[u].sum=tr[<span class="hljs-built_in">ls</span>(u)].sum+tr[<span class="hljs-built_in">rs</span>(u)].sum+tr[u].tp.w;<br>    tr[u].siz=tr[<span class="hljs-built_in">ls</span>(u)].siz+tr[<span class="hljs-built_in">rs</span>(u)].siz<span class="hljs-number">+1</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pia</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> num)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(u)) <span class="hljs-built_in">pia</span>(<span class="hljs-built_in">ls</span>(u),num);<br>    p[tr[<span class="hljs-built_in">ls</span>(u)].siz+num<span class="hljs-number">+1</span>]=tr[u].tp,rub[++top]=u;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(u)) <span class="hljs-built_in">pia</span>(<span class="hljs-built_in">rs</span>(u),num+tr[<span class="hljs-built_in">ls</span>(u)].siz<span class="hljs-number">+1</span>);<br>&#125;<br><span class="hljs-type">int</span> D;<br><span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (Point a,Point b)&#123;<br>    <span class="hljs-keyword">return</span> a.pos[D]&lt;b.pos[D];<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">rebuild</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> d)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(l&gt;r) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>,k=<span class="hljs-built_in">newnode</span>();<br>    D=d;<span class="hljs-built_in">nth_element</span>(p+l,p+mid,p+r<span class="hljs-number">+1</span>);<br>    tr[k].tp=p[mid];<br>    tr[k].ls=<span class="hljs-built_in">rebuild</span>(l,mid<span class="hljs-number">-1</span>,d^<span class="hljs-number">1</span>);<br>    tr[k].rs=<span class="hljs-built_in">rebuild</span>(mid<span class="hljs-number">+1</span>,r,d^<span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">pushup</span>(k);<br>    <span class="hljs-keyword">return</span> k;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">check</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> d)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(tr[<span class="hljs-built_in">ls</span>(u)].siz&gt;tr[u].siz*<span class="hljs-number">0.72</span>||tr[<span class="hljs-built_in">rs</span>(u)].siz&gt;tr[u].siz*<span class="hljs-number">0.72</span>)&#123;<br>        <span class="hljs-built_in">pia</span>(u,<span class="hljs-number">0</span>);u=<span class="hljs-built_in">rebuild</span>(<span class="hljs-number">1</span>,tr[u].siz,d);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,Point k,<span class="hljs-type">int</span> d)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(!u)&#123;u=<span class="hljs-built_in">newnode</span>(),<span class="hljs-built_in">ls</span>(u)=<span class="hljs-built_in">rs</span>(u)=<span class="hljs-number">0</span>,tr[u].tp=k,<span class="hljs-built_in">pushup</span>(u);<span class="hljs-keyword">return</span>;&#125;<br>    <span class="hljs-keyword">if</span>(k.pos[d]&lt;=tr[u].tp.pos[d]) <span class="hljs-built_in">insert</span>(<span class="hljs-built_in">ls</span>(u),k,d^<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">else</span> <span class="hljs-built_in">insert</span>(<span class="hljs-built_in">rs</span>(u),k,d^<span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">pushup</span>(u);<br>    <span class="hljs-built_in">check</span>(u,d);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">in</span><span class="hljs-params">(<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2,<span class="hljs-type">int</span> X1,<span class="hljs-type">int</span> Y1,<span class="hljs-type">int</span> X2,<span class="hljs-type">int</span> Y2)</span> </span>&#123;<br>	<span class="hljs-keyword">return</span> (X1&gt;=x1&amp;&amp;X2&lt;=x2&amp;&amp;Y1&gt;=y1&amp;&amp;Y2&lt;=y2);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">out</span><span class="hljs-params">(<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2,<span class="hljs-type">int</span> X1,<span class="hljs-type">int</span> Y1,<span class="hljs-type">int</span> X2,<span class="hljs-type">int</span> Y2)</span> </span>&#123;<br>	<span class="hljs-keyword">return</span> (x1&gt;X2||x2&lt;X1||y1&gt;Y2||y2&lt;Y1);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(!u) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">in</span>(x1,y1,x2,y2,tr[u].mi[<span class="hljs-number">0</span>],tr[u].mi[<span class="hljs-number">1</span>],tr[u].ma[<span class="hljs-number">0</span>],tr[u].ma[<span class="hljs-number">1</span>])) <span class="hljs-keyword">return</span> tr[u].sum;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">out</span>(x1,y1,x2,y2,tr[u].mi[<span class="hljs-number">0</span>],tr[u].mi[<span class="hljs-number">1</span>],tr[u].ma[<span class="hljs-number">0</span>],tr[u].ma[<span class="hljs-number">1</span>])) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">in</span>(x1,y1,x2,y2,tr[u].tp.pos[<span class="hljs-number">0</span>],tr[u].tp.pos[<span class="hljs-number">1</span>],tr[u].tp.pos[<span class="hljs-number">0</span>],tr[u].tp.pos[<span class="hljs-number">1</span>])) res+=tr[u].tp.w;<br>    res+=<span class="hljs-built_in">query</span>(<span class="hljs-built_in">ls</span>(u),x1,y1,x2,y2)+<span class="hljs-built_in">query</span>(<span class="hljs-built_in">rs</span>(u),x1,y1,x2,y2);<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;n;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-string">&quot;ဪ&quot;</span>)&#123;<br>        <span class="hljs-type">int</span> op;<br>        cin&gt;&gt;op;<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-number">3</span>) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-type">int</span> x,y,a;<br>            cin&gt;&gt;x&gt;&gt;y&gt;&gt;a;<br>            <span class="hljs-built_in">insert</span>(rt,(Point)&#123;x^ans,y^ans,a^ans&#125;,<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-type">int</span> x1,x2,y1,y2;<br>            cin&gt;&gt;x1&gt;&gt;y1&gt;&gt;x2&gt;&gt;y2;<br>            ans=<span class="hljs-built_in">query</span>(rt,x1^ans,y1^ans,x2^ans,y2^ans);<br>            cout&lt;&lt;ans&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>        &#125;<br>    &#125;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3710">LuoguP3710</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(x) tr[x].ls</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(x) tr[x].rs</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long </span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1.5e5</span><span class="hljs-number">+10</span>,MOD=<span class="hljs-number">998244353</span>;<br><span class="hljs-type">int</span> n,m,cnt,rt,D,tot;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Change</span>&#123;<span class="hljs-type">int</span> l,r,d,op,end;&#125;c[N];<br><span class="hljs-comment">//0位置1时间</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>    <span class="hljs-type">int</span> ls,rs,mi[<span class="hljs-number">2</span>],ma[<span class="hljs-number">2</span>],add,mul,pos[<span class="hljs-number">2</span>],val;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-type">const</span> Node &amp;t) <span class="hljs-type">const</span>&#123;<br>        <span class="hljs-keyword">return</span> pos[D]&lt;t.pos[D];<br>    &#125;    <br>&#125;tr[N],q[N];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mul</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    tr[u].val=tr[u].val*k%MOD;<br>    tr[u].add=tr[u].add*k%MOD;<br>    tr[u].mul=tr[u].mul*k%MOD;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    tr[u].val=(tr[u].val+k)%MOD;<br>    tr[u].add=(tr[u].add+k)%MOD;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(tr[u].mul!=<span class="hljs-number">1</span>) <span class="hljs-built_in">mul</span>(<span class="hljs-built_in">ls</span>(u),tr[u].mul),<span class="hljs-built_in">mul</span>(<span class="hljs-built_in">rs</span>(u),tr[u].mul),tr[u].mul=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span>(tr[u].add) <span class="hljs-built_in">add</span>(<span class="hljs-built_in">ls</span>(u),tr[u].add),<span class="hljs-built_in">add</span>(<span class="hljs-built_in">rs</span>(u),tr[u].add),tr[u].add=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">1</span>;i++)&#123;<br>        tr[u].ma[i]=tr[u].mi[i]=tr[u].pos[i];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(u))&#123;<br>            tr[u].ma[i]=<span class="hljs-built_in">max</span>(tr[u].ma[i],tr[<span class="hljs-built_in">ls</span>(u)].ma[i]);<br>            tr[u].mi[i]=<span class="hljs-built_in">min</span>(tr[u].mi[i],tr[<span class="hljs-built_in">ls</span>(u)].mi[i]);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(u))&#123;<br>            tr[u].ma[i]=<span class="hljs-built_in">max</span>(tr[u].ma[i],tr[<span class="hljs-built_in">rs</span>(u)].ma[i]);<br>            tr[u].mi[i]=<span class="hljs-built_in">min</span>(tr[u].mi[i],tr[<span class="hljs-built_in">rs</span>(u)].mi[i]);            <br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> d)</span></span>&#123;<br>    u=++tot;D=d;<br>    <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">nth_element</span>(q+l<span class="hljs-number">+1</span>,q+mid<span class="hljs-number">+1</span>,q+r<span class="hljs-number">+1</span>);<br>    tr[u]=q[mid],tr[u].mul=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span>(l&lt;mid) <span class="hljs-built_in">build</span>(<span class="hljs-built_in">ls</span>(u),l,mid<span class="hljs-number">-1</span>,d^<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(r&gt;mid) <span class="hljs-built_in">build</span>(<span class="hljs-built_in">rs</span>(u),mid<span class="hljs-number">+1</span>,r,d^<span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">pushup</span>(u);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">out</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> x1&gt;tr[u].ma[<span class="hljs-number">0</span>]||x2&lt;tr[u].mi[<span class="hljs-number">0</span>]||y1&gt;tr[u].ma[<span class="hljs-number">1</span>]||y2&lt;tr[u].mi[<span class="hljs-number">1</span>];<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">in</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> x1&lt;=tr[u].mi[<span class="hljs-number">0</span>]&amp;&amp;x2&gt;=tr[u].ma[<span class="hljs-number">0</span>]&amp;&amp;y1&lt;=tr[u].mi[<span class="hljs-number">1</span>]&amp;&amp;y2&gt;=tr[u].ma[<span class="hljs-number">1</span>];<br>    <span class="hljs-comment">//节点u代表的矩形是否包含于修改的矩形</span><br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">check</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> x1&lt;=tr[u].pos[<span class="hljs-number">0</span>]&amp;&amp;x2&gt;=tr[u].pos[<span class="hljs-number">0</span>]&amp;&amp;y1&lt;=tr[u].pos[<span class="hljs-number">1</span>]&amp;&amp;y2&gt;=tr[u].pos[<span class="hljs-number">1</span>];<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">out</span>(u,x1,y1,x2,y2)) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">in</span>(u,x1,y1,x2,y2))&#123;<br>        <span class="hljs-built_in">add</span>(u,k);<span class="hljs-comment">//全部包含，整体修改</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>(u,x1,y1,x2,y2)) tr[u].val=(tr[u].val+k)%MOD;<span class="hljs-comment">//当前的点上正好有一个询问，修改询问的结果</span><br>    <span class="hljs-built_in">pushdown</span>(u);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(u)) <span class="hljs-built_in">add</span>(<span class="hljs-built_in">ls</span>(u),x1,y1,x2,y2,k);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(u)) <span class="hljs-built_in">add</span>(<span class="hljs-built_in">rs</span>(u),x1,y1,x2,y2,k);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mul</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> x1,<span class="hljs-type">int</span> y1,<span class="hljs-type">int</span> x2,<span class="hljs-type">int</span> y2,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-comment">//与add同理</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">out</span>(u,x1,y1,x2,y2)) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">in</span>(u,x1,y1,x2,y2))&#123;<br>        <span class="hljs-built_in">mul</span>(u,k);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>(u,x1,y1,x2,y2)) tr[u].val=tr[u].val*k%MOD;<br>    <span class="hljs-built_in">pushdown</span>(u);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(u)) <span class="hljs-built_in">mul</span>(<span class="hljs-built_in">ls</span>(u),x1,y1,x2,y2,k);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(u)) <span class="hljs-built_in">mul</span>(<span class="hljs-built_in">rs</span>(u),x1,y1,x2,y2,k);    <br>&#125;<br><span class="hljs-type">int</span> ans;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(x&gt;tr[u].ma[<span class="hljs-number">0</span>]||x&lt;tr[u].mi[<span class="hljs-number">0</span>]||y&gt;tr[u].ma[<span class="hljs-number">1</span>]||y&lt;tr[u].mi[<span class="hljs-number">1</span>]) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">if</span>(x==tr[u].pos[<span class="hljs-number">0</span>]&amp;&amp;y==tr[u].pos[<span class="hljs-number">1</span>])&#123;<br>        ans=tr[u].val;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-built_in">pushdown</span>(u);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">ls</span>(u)) <span class="hljs-built_in">query</span>(<span class="hljs-built_in">ls</span>(u),x,y);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">rs</span>(u)) <span class="hljs-built_in">query</span>(<span class="hljs-built_in">rs</span>(u),x,y);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//每个修改可能会被撤销，以位置为x轴，时间为y轴，则每个修改对一个矩形产生了影响</span><br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;n&gt;&gt;m;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        cin&gt;&gt;c[i].op;<br>        <span class="hljs-keyword">if</span>(c[i].op&lt;=<span class="hljs-number">2</span>)&#123;<br>            cin&gt;&gt;c[i].l&gt;&gt;c[i].r&gt;&gt;c[i].d;<br>            c[i].d%=MOD;<br>            c[i].end=m;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-type">int</span> p;cin&gt;&gt;p;<br>        <span class="hljs-keyword">if</span>(c[i].op==<span class="hljs-number">4</span>) c[p].end=i;<span class="hljs-comment">//存在到end位置，默认为m</span><br>        <span class="hljs-keyword">if</span>(c[i].op==<span class="hljs-number">3</span>)&#123;<br>            c[i].end=p;<br>            q[++cnt].pos[<span class="hljs-number">0</span>]=p,q[cnt].pos[<span class="hljs-number">1</span>]=i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">build</span>(rt,<span class="hljs-number">1</span>,cnt,<span class="hljs-number">0</span>);<span class="hljs-comment">//建树，把询问先插入到平面里，以后只修改带询问的点，没问到的不管</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-keyword">if</span>(c[i].op==<span class="hljs-number">1</span>) <span class="hljs-built_in">add</span>(rt,c[i].l,i,c[i].r,c[i].end,c[i].d);<span class="hljs-comment">//矩形左下角(l,i)，右上角(r,end)，因为第i个修改从时间i开始，结束于end</span><br>        <span class="hljs-keyword">if</span>(c[i].op==<span class="hljs-number">2</span>) <span class="hljs-built_in">mul</span>(rt,c[i].l,i,c[i].r,c[i].end,c[i].d);<br>        <span class="hljs-keyword">if</span>(c[i].op==<span class="hljs-number">3</span>)&#123;<br>            <span class="hljs-built_in">query</span>(rt,c[i].end,i);<span class="hljs-comment">//查询平面上点(pos,i)的值，即pos在时间i时的值</span><br>            cout&lt;&lt;ans&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>        &#125;<br>    &#125;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP2801">LuoguP2801</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e6</span><span class="hljs-number">+10</span>;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">int</span> n,q,a[N],len,bel[N],ll[N],rr[N],cnt,b[N],tag[N];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">resort</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=ll[x];i&lt;=rr[x];i++) b[i]=a[i];<br>	<span class="hljs-built_in">sort</span>(b+ll[x],b+rr[x]<span class="hljs-number">+1</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(bel[l]==bel[r])&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=r;i++) a[i]+=k;<br>		<span class="hljs-built_in">resort</span>(bel[l]);<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=rr[bel[l]];i++) a[i]+=k;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=ll[bel[r]];j&lt;=r;j++) a[j]+=k;<br>	<span class="hljs-built_in">resort</span>(bel[l]),<span class="hljs-built_in">resort</span>(bel[r]);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=bel[l]<span class="hljs-number">+1</span>;i&lt;bel[r];i++) tag[i]+=k;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-type">int</span> l=ll[x],r=rr[x];<br>	<span class="hljs-keyword">while</span>(l&lt;=r)&#123;<br>		<span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span>(b[mid]&lt;k) l=mid<span class="hljs-number">+1</span>;<br>		<span class="hljs-keyword">else</span> r=mid<span class="hljs-number">-1</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> rr[x]-(l<span class="hljs-number">-1</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-type">int</span> res=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span>(bel[l]==bel[r])&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=r;i++)&#123;<br>			<span class="hljs-keyword">if</span>(a[i]+tag[bel[l]]&gt;=k) res++;<br>		&#125;<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=rr[bel[l]];i++) <span class="hljs-keyword">if</span>(a[i]+tag[bel[l]]&gt;=k) res++;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=ll[bel[r]];i&lt;=r;i++) <span class="hljs-keyword">if</span>(a[i]+tag[bel[r]]&gt;=k) res++;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=bel[l]<span class="hljs-number">+1</span>;i&lt;bel[r];i++) res+=<span class="hljs-built_in">find</span>(i,k-tag[i]);<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;q;<br>	len=<span class="hljs-built_in">sqrt</span>(n);<br>	cnt=n/len;<span class="hljs-keyword">if</span>(n%len) cnt++;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		cin&gt;&gt;a[i];b[i]=a[i];<br>		bel[i]=(i<span class="hljs-number">-1</span>)/len<span class="hljs-number">+1</span>;<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=cnt;i++) ll[i]=(i<span class="hljs-number">-1</span>)*len<span class="hljs-number">+1</span>,rr[i]=i*len;<br>	rr[cnt]=n;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=cnt;i++) <span class="hljs-built_in">sort</span>(b+ll[i],b+rr[i]<span class="hljs-number">+1</span>);<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=q;i++)&#123;<br>		<span class="hljs-type">char</span> c;<span class="hljs-type">int</span> l,r,k;<br>		cin&gt;&gt;c&gt;&gt;l&gt;&gt;r&gt;&gt;k;<br>		<span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;M&#x27;</span>) <span class="hljs-built_in">add</span>(l,r,k);<br>		<span class="hljs-keyword">else</span> cout&lt;&lt;<span class="hljs-built_in">query</span>(l,r,k)&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3203">LuoguP3203</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> bel[N],L[N],R[N],num[N],jump[N],step[N],cnt,n;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=r;i&gt;=l;i--)&#123;<br>        <span class="hljs-keyword">if</span> (i+num[i]&gt;R[bel[i]])&#123;<br>            jump[i]=i+num[i];<br>            step[i]=<span class="hljs-number">1</span>;<br>        &#125; <br>		<span class="hljs-keyword">else</span>&#123;<br>            jump[i]=jump[i+num[i]];<br>            step[i]=step[i+num[i]]<span class="hljs-number">+1</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">ask</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(x&lt;n)&#123;<br>        ans+=step[x];<br>        x=jump[x];<br>    &#125;<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    cin&gt;&gt;n;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++) cin&gt;&gt;num[i];<br>    cnt=<span class="hljs-built_in">sqrt</span>(n);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++) bel[i]=i/cnt;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=bel[n<span class="hljs-number">-1</span>];i++) L[i]=i*cnt,R[i]=(i<span class="hljs-number">+1</span>)*cnt<span class="hljs-number">-1</span>;<br>    R[bel[n<span class="hljs-number">-1</span>]]=n<span class="hljs-number">-1</span>;<br>    <span class="hljs-built_in">update</span>(<span class="hljs-number">0</span>,n<span class="hljs-number">-1</span>);<br>    <span class="hljs-type">int</span> q;<br>    cin&gt;&gt;q;<br>    <span class="hljs-keyword">while</span>(q--)&#123;<br>        <span class="hljs-type">int</span> op,x,y;<br>        cin&gt;&gt;op&gt;&gt;x;<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<br>            cout&lt;&lt;<span class="hljs-built_in">ask</span>(x)&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>        &#125; <br>		<span class="hljs-keyword">else</span>&#123;<br>            cin&gt;&gt;y;<br>            num[x]=y;<br>            <span class="hljs-built_in">update</span>(L[bel[x]],R[bel[x]]);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3863">LuoguP3863</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">5e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,Q,a[N],cnt1,cnt2,ans[N];<br><span class="hljs-type">int</span> L[N],R[N],bel[N],add[N],cnt,B,b[N],order[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Change</span>&#123;<br>    <span class="hljs-type">int</span> pos,tim,v;<br>&#125;c[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Query</span>&#123;<br>    <span class="hljs-type">int</span> pos,v,tim,id;<br>&#125;q[N];<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp1</span><span class="hljs-params">(Change x,Change y)</span></span>&#123;<span class="hljs-keyword">return</span> x.pos==y.pos?x.tim&lt;y.tim:x.pos&lt;y.pos;&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp2</span><span class="hljs-params">(Query x,Query y)</span></span>&#123;<span class="hljs-keyword">return</span> x.pos==y.pos?x.tim&lt;y.tim:x.pos&lt;y.pos;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(bel[l]==bel[r])&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=r;i++) b[i]+=k;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=L[bel[l]];i&lt;=R[bel[l]];i++) order[i]=b[i];<br>        <span class="hljs-built_in">sort</span>(order+L[bel[l]],order+R[bel[l]]<span class="hljs-number">+1</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=R[bel[l]];i++) b[i]+=k;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=L[bel[l]];i&lt;=R[bel[l]];i++) order[i]=b[i];<br>        <span class="hljs-built_in">sort</span>(order+L[bel[l]],order+R[bel[l]]<span class="hljs-number">+1</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=L[bel[r]];i&lt;=r;i++) b[i]+=k;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=L[bel[r]];i&lt;=R[bel[r]];i++) order[i]=b[i];<br>        <span class="hljs-built_in">sort</span>(order+L[bel[r]],order+R[bel[r]]<span class="hljs-number">+1</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=bel[l]<span class="hljs-number">+1</span>;i&lt;bel[r];i++) add[i]+=k;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>    <span class="hljs-type">int</span> l=<span class="hljs-number">0</span>,res=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(bel[l]==bel[r])&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=r;i++) <span class="hljs-keyword">if</span>(b[i]+add[bel[l]]&gt;=k) res++;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=l;i&lt;=R[bel[l]];i++) <span class="hljs-keyword">if</span>(b[i]+add[bel[l]]&gt;=k) res++;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=L[bel[r]];i&lt;=r;i++) <span class="hljs-keyword">if</span>(b[i]+add[bel[r]]&gt;=k) res++;<br>        <span class="hljs-comment">//cerr&lt;&lt;res&lt;&lt;endl;</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=bel[l]<span class="hljs-number">+1</span>;i&lt;bel[r];i++)&#123;<br>            <span class="hljs-type">int</span> t=<span class="hljs-built_in">lower_bound</span>(order+L[i],order+R[i]<span class="hljs-number">+1</span>,k-add[i])-(order+L[i]);<br>            res+=(R[i]-L[i]<span class="hljs-number">+1</span>)-t;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	<span class="hljs-comment">//freopen(&quot;P3863_15.in&quot;,&quot;r&quot;,stdin);</span><br>	<span class="hljs-comment">//freopen(&quot;1.out&quot;,&quot;w&quot;,stdout);</span><br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;n&gt;&gt;Q;<br>    B=<span class="hljs-built_in">sqrt</span>(Q);<br>    cnt=Q/B;<span class="hljs-keyword">if</span>(Q%B) cnt++;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=cnt;i++) L[i]=(i<span class="hljs-number">-1</span>)*B<span class="hljs-number">+1</span>,R[i]=<span class="hljs-built_in">min</span>(i*B,Q);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;a[i];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=Q;i++)&#123;<br>        bel[i]=(i<span class="hljs-number">-1</span>)/B<span class="hljs-number">+1</span>;<br>        <span class="hljs-type">int</span> op;<br>        cin&gt;&gt;op;<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-type">int</span> l,r,x;<br>            cin&gt;&gt;l&gt;&gt;r&gt;&gt;x;<br>            c[++cnt1]=(Change)&#123;l,i,x&#125;;<br>            c[++cnt1]=(Change)&#123;r<span class="hljs-number">+1</span>,i,-x&#125;;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-type">int</span> p,y;<br>            cin&gt;&gt;p&gt;&gt;y;<br>            q[++cnt2]=(Query)&#123;p,y,i,cnt2&#125;;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(c<span class="hljs-number">+1</span>,c+cnt1<span class="hljs-number">+1</span>,cmp1);<br>    <span class="hljs-built_in">sort</span>(q<span class="hljs-number">+1</span>,q+cnt2<span class="hljs-number">+1</span>,cmp2);<br>    <span class="hljs-type">int</span> ch=<span class="hljs-number">1</span>,qu=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<span class="hljs-comment">//处理每个数</span><br>        <span class="hljs-built_in">add_</span>(<span class="hljs-number">0</span>,Q,a[i]-a[i<span class="hljs-number">-1</span>]);<br>        <span class="hljs-keyword">while</span>(c[ch].pos==i) <span class="hljs-built_in">add_</span>(c[ch].tim,Q,c[ch].v),ch++;<br>        <span class="hljs-keyword">while</span>(q[qu].pos==i)&#123;<br>            ans[q[qu].id]=<span class="hljs-built_in">query</span>(q[qu].tim<span class="hljs-number">-1</span>,q[qu].v);<br>            <span class="hljs-comment">//if(a[i]&gt;=q[qu].v) ans[q[qu].id]++;</span><br>            qu++;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=cnt2;i++) cout&lt;&lt;ans[i]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="CF1179C">CF1179C</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (u&lt;&lt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (u&lt;&lt;1|1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e6</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,a[N],b[N],q,mi[N&lt;&lt;<span class="hljs-number">2</span>],tag[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	mi[ls]+=tag[u];mi[rs]+=tag[u];<br>	tag[ls]+=tag[u];tag[rs]+=tag[u];<br>	tag[u]=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<br>		mi[u]+=k;tag[u]+=k;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-built_in">pushdown</span>(u);<br>	<span class="hljs-keyword">if</span>(L&lt;=mid) <span class="hljs-built_in">insert</span>(ls,l,mid,L,R,k);<br>	<span class="hljs-keyword">if</span>(R&gt;mid) <span class="hljs-built_in">insert</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R,k);<br>	mi[u]=<span class="hljs-built_in">min</span>(mi[ls],mi[rs]);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(mi[u]&gt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> l;<br>	<span class="hljs-built_in">pushdown</span>(u);<br>	<span class="hljs-keyword">if</span>(mi[rs]&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(rs,mid<span class="hljs-number">+1</span>,r);<br>	<span class="hljs-keyword">if</span>(mi[ls]&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(ls,l,mid);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>		cin&gt;&gt;a[i];<br>		<span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,N<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>,a[i],<span class="hljs-number">-1</span>);<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>		cin&gt;&gt;b[i];<br>		<span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,N<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>,b[i],<span class="hljs-number">1</span>);<br>	&#125;<br>	cin&gt;&gt;q;<br>	<span class="hljs-keyword">while</span>(q--)&#123;<br>		<span class="hljs-type">int</span> op,i,x;<br>		cin&gt;&gt;op&gt;&gt;i&gt;&gt;x;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)&#123;<br>			<span class="hljs-keyword">if</span>(x&gt;a[i]) <span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,N<span class="hljs-number">-1</span>,a[i]<span class="hljs-number">+1</span>,x,<span class="hljs-number">-1</span>);<br>			<span class="hljs-keyword">else</span> <span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,N<span class="hljs-number">-1</span>,x<span class="hljs-number">+1</span>,a[i],<span class="hljs-number">1</span>);<br>            <span class="hljs-comment">// 这里可以画图理解一下</span><br>            <span class="hljs-comment">// 就是减去原本 a_i 的贡献，加上 x_i 的贡献，影响的就是不重叠的那段区间</span><br>			a[i]=x;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-keyword">if</span>(x&gt;b[i]) <span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,N<span class="hljs-number">-1</span>,b[i]<span class="hljs-number">+1</span>,x,<span class="hljs-number">1</span>);<br>			<span class="hljs-keyword">else</span> <span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,N<span class="hljs-number">-1</span>,x<span class="hljs-number">+1</span>,b[i],<span class="hljs-number">-1</span>);<br>			b[i]=x;			<br>		&#125;<br>		cout&lt;&lt;<span class="hljs-built_in">query</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,N<span class="hljs-number">-1</span>)&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="CF85D">CF85D</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls(x) tr[x].ls</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs(x) tr[x].rs</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">3e5</span><span class="hljs-number">+10</span>,M=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> n,rt,tot;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> cnt,sum[<span class="hljs-number">5</span>],ls,rs;<br>&#125;tr[N&lt;&lt;<span class="hljs-number">3</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span></span>&#123;<br>	tr[u].cnt=tr[<span class="hljs-built_in">ls</span>(u)].cnt+tr[<span class="hljs-built_in">rs</span>(u)].cnt;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">5</span>;i++)&#123;<br>		tr[u].sum[i]=tr[<span class="hljs-built_in">ls</span>(u)].sum[i]+tr[<span class="hljs-built_in">rs</span>(u)].sum[((i-tr[<span class="hljs-built_in">ls</span>(u)].cnt)%<span class="hljs-number">5</span><span class="hljs-number">+5</span>)%<span class="hljs-number">5</span>];<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(!u) u=++tot;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].sum[<span class="hljs-number">1</span>]=U;tr[u].cnt=<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">add</span>(<span class="hljs-built_in">ls</span>(u),l,mid,U);<br>	<span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(<span class="hljs-built_in">rs</span>(u),mid<span class="hljs-number">+1</span>,r,U);<br>	<span class="hljs-built_in">pushup</span>(u);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> U)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(!u) u=++tot;<br>	<span class="hljs-keyword">if</span>(l==r)&#123;<br>		tr[u].sum[<span class="hljs-number">1</span>]=tr[u].cnt=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-keyword">if</span>(U&lt;=mid) <span class="hljs-built_in">del</span>(<span class="hljs-built_in">ls</span>(u),l,mid,U);<br>	<span class="hljs-keyword">else</span> <span class="hljs-built_in">del</span>(<span class="hljs-built_in">rs</span>(u),mid<span class="hljs-number">+1</span>,r,U);<br>	<span class="hljs-built_in">pushup</span>(u);	<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n;<br>	<span class="hljs-keyword">while</span>(n--)&#123;<br>		string op;<span class="hljs-type">int</span> x;<br>		cin&gt;&gt;op;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-string">&quot;sum&quot;</span>)&#123;<br>			cout&lt;&lt;tr[<span class="hljs-number">1</span>].sum[<span class="hljs-number">3</span>]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>			<span class="hljs-keyword">continue</span>;<br>		&#125;<br>		cin&gt;&gt;x;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-string">&quot;add&quot;</span>) <span class="hljs-built_in">add</span>(rt,<span class="hljs-number">1</span>,M,x);<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-string">&quot;del&quot;</span>) <span class="hljs-built_in">del</span>(rt,<span class="hljs-number">1</span>,M,x);<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3071">LuoguP3071</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ls u&lt;&lt;1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rs u&lt;&lt;1|1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)&gt;&gt;1)</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">5e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-type">int</span> n,m,ans;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>	<span class="hljs-type">int</span> lma,rma,ma,tag;<br>&#125;tr[N&lt;&lt;<span class="hljs-number">2</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	tr[u].ma=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(tr[ls].ma,tr[rs].ma),tr[ls].rma+tr[rs].lma);<br>	<span class="hljs-keyword">if</span>(tr[ls].ma==mid-l<span class="hljs-number">+1</span>) tr[u].lma=tr[ls].ma+tr[rs].lma;<br>	<span class="hljs-keyword">else</span> tr[u].lma=tr[ls].lma;<br>	<span class="hljs-keyword">if</span>(tr[rs].ma==r-mid) tr[u].rma=tr[rs].ma+tr[ls].rma;<br>	<span class="hljs-keyword">else</span> tr[u].rma=tr[rs].rma;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	tr[u].lma=tr[u].rma=tr[u].ma=r-l<span class="hljs-number">+1</span>;<br>	tr[u].tag=<span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-built_in">build</span>(ls,l,mid);<br>	<span class="hljs-built_in">build</span>(rs,mid<span class="hljs-number">+1</span>,r);<br>	<span class="hljs-built_in">pushup</span>(u,l,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(tr[u].tag==<span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-keyword">if</span>(tr[u].tag==<span class="hljs-number">1</span>)&#123;<span class="hljs-comment">//覆盖</span><br>		tr[ls].lma=tr[ls].rma=tr[ls].ma=<span class="hljs-number">0</span>;<br>		tr[rs].lma=tr[rs].rma=tr[rs].ma=<span class="hljs-number">0</span>;<br>	&#125;<br>	<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">//清空</span><br>		tr[ls].lma=tr[ls].rma=tr[ls].ma=mid-l<span class="hljs-number">+1</span>;<br>		tr[rs].lma=tr[rs].rma=tr[rs].ma=r-mid;<br>	&#125;<br>	tr[ls].tag=tr[rs].tag=tr[u].tag;<br>	tr[u].tag=<span class="hljs-number">-1</span>;		<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span></span>&#123;<br>	<span class="hljs-built_in">pushdown</span>(u,l,r);<br>	<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> l;<br>	<span class="hljs-keyword">if</span>(tr[ls].ma&gt;=k) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(ls,l,mid,k);<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(tr[ls].rma+tr[rs].lma&gt;=k) <span class="hljs-keyword">return</span> mid-tr[ls].rma<span class="hljs-number">+1</span>;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(rs,mid<span class="hljs-number">+1</span>,r,k);<br>	<span class="hljs-comment">//先选左边，再选中间，再选右边</span><br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> L,<span class="hljs-type">int</span> R,<span class="hljs-type">bool</span> op)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>) tr[u].lma=tr[u].rma=tr[u].ma=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">else</span> tr[u].lma=tr[u].rma=tr[u].ma=r-l<span class="hljs-number">+1</span>;<br>		tr[u].tag=op;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>	<span class="hljs-built_in">pushdown</span>(u,l,r);<br>	<span class="hljs-keyword">if</span>(L&lt;=mid) <span class="hljs-built_in">update</span>(ls,l,mid,L,R,op);<br>	<span class="hljs-keyword">if</span>(R&gt;mid) <span class="hljs-built_in">update</span>(rs,mid<span class="hljs-number">+1</span>,r,L,R,op);<br>	<span class="hljs-built_in">pushup</span>(u,l,r);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	<span class="hljs-built_in">freopen</span>(<span class="hljs-string">&quot;seating.in&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>,stdin);<br>	<span class="hljs-built_in">freopen</span>(<span class="hljs-string">&quot;seating.out&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>,stdout);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n);<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		<span class="hljs-type">char</span> op;<br>		<span class="hljs-type">int</span> a,b;<br>		cin&gt;&gt;op&gt;&gt;a;<br>		<span class="hljs-keyword">if</span>(op==<span class="hljs-string">&#x27;A&#x27;</span>)&#123;<br>			<span class="hljs-keyword">if</span>(tr[<span class="hljs-number">1</span>].ma&lt;a) ans++;<br>			<span class="hljs-keyword">else</span>&#123;<br>				<span class="hljs-type">int</span> pos=<span class="hljs-built_in">query</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,a);<br>				<span class="hljs-built_in">update</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,pos,pos+a<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			cin&gt;&gt;b;<br>			<span class="hljs-built_in">update</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,a,b,<span class="hljs-number">0</span>);<br>		&#125;<br>	&#125;<br>	cout&lt;&lt;ans;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP2756">LuoguP2756</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">500</span>,INF=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> n,m,head[N],tot=<span class="hljs-number">1</span>,dep[N],cur[N],s,t;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<br>    <span class="hljs-type">int</span> to,nxt,f;<br>&#125;e[<span class="hljs-number">50010</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addedge</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c)</span></span>&#123;<br>    e[++tot].nxt=head[u];<br>    e[tot].to=v;<br>    e[tot].f=c;<br>    head[u]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>    <span class="hljs-built_in">memset</span>(dep,<span class="hljs-number">-1</span>,<span class="hljs-built_in">sizeof</span>(dep));<br>    q.<span class="hljs-built_in">push</span>(s);<br>    dep[s]=<span class="hljs-number">0</span>;cur[s]=head[s];<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>        <span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>            <span class="hljs-type">int</span> v=e[i].to;<br>            <span class="hljs-keyword">if</span>(e[i].f&amp;&amp;dep[v]==<span class="hljs-number">-1</span>)&#123;<br>                dep[v]=dep[u]<span class="hljs-number">+1</span>;<br>                cur[v]=head[v];<br>                <span class="hljs-keyword">if</span>(v==t) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>                q.<span class="hljs-built_in">push</span>(v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> limit)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(u==t) <span class="hljs-keyword">return</span> limit;<br>    <span class="hljs-type">int</span> flow=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=cur[u];i&amp;&amp;flow&lt;limit;i=e[i].nxt)&#123;<br>        cur[u]=i;<br>        <span class="hljs-type">int</span> v=e[i].to;<br>        <span class="hljs-keyword">if</span>(dep[v]==dep[u]<span class="hljs-number">+1</span>&amp;&amp;e[i].f)&#123;<br>            <span class="hljs-type">int</span> t=<span class="hljs-built_in">find</span>(v,<span class="hljs-built_in">min</span>(e[i].f,limit-flow));<br>            <span class="hljs-keyword">if</span>(!t) dep[v]=<span class="hljs-number">-1</span>;<br>            e[i].f-=t;e[i^<span class="hljs-number">1</span>].f+=t;<br>            flow+=t;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> flow;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;m&gt;&gt;n;<br>    s=n<span class="hljs-number">+1</span>,t=n<span class="hljs-number">+2</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-built_in">addedge</span>(s,i,<span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">addedge</span>(i,s,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=m<span class="hljs-number">+1</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-built_in">addedge</span>(i,t,<span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">addedge</span>(t,i,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-type">int</span> u,v;<br>    <span class="hljs-keyword">while</span>(cin&gt;&gt;u&gt;&gt;v)&#123;<br>        <span class="hljs-keyword">if</span>(u==<span class="hljs-number">-1</span>) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-built_in">addedge</span>(u,v,<span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">addedge</span>(v,u,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>())&#123;<br>        <span class="hljs-type">int</span> flow;<br>        <span class="hljs-keyword">while</span>(flow=<span class="hljs-built_in">find</span>(s,INF)) ans+=flow;<br>    &#125;<br>    cout&lt;&lt;ans&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=head[i];j;j=e[j].nxt)&#123;<br>            <span class="hljs-keyword">if</span>(!e[j].f&amp;&amp;e[j].to&lt;=n) cout&lt;&lt;i&lt;&lt;<span class="hljs-string">&#x27; &#x27;</span>&lt;&lt;e[j].to&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>        &#125;<br>    &#125;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP3254">LuoguP3254</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1000</span>,INF=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> n,m,s,t,tot=<span class="hljs-number">1</span>,dep[N],cur[N],head[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<br>    <span class="hljs-type">int</span> to,nxt,f;<br>&#125;e[<span class="hljs-number">100000</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addedge</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c)</span></span>&#123;<br>    e[++tot].nxt=head[u];e[tot].to=v;e[tot].f=c;<br>    head[u]=tot;<br>    e[++tot].nxt=head[v];e[tot].to=u;e[tot].f=<span class="hljs-number">0</span>;<br>    head[v]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>    <span class="hljs-built_in">memset</span>(dep,<span class="hljs-number">-1</span>,<span class="hljs-built_in">sizeof</span>(dep));<br>    q.<span class="hljs-built_in">push</span>(s);<br>    dep[s]=<span class="hljs-number">0</span>;cur[s]=head[s];<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>        <span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>            <span class="hljs-type">int</span> v=e[i].to;<br>            <span class="hljs-keyword">if</span>(dep[v]==<span class="hljs-number">-1</span>&amp;&amp;e[i].f)&#123;<br>                dep[v]=dep[u]<span class="hljs-number">+1</span>;cur[v]=head[v];<br>                <span class="hljs-keyword">if</span>(v==t) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>                q.<span class="hljs-built_in">push</span>(v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> limit)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(u==t) <span class="hljs-keyword">return</span> limit;<br>    <span class="hljs-type">int</span> flow=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=cur[u];i&amp;&amp;flow&lt;limit;i=e[i].nxt)&#123;<br>        cur[u]=i;<br>        <span class="hljs-type">int</span> v=e[i].to;<br>        <span class="hljs-keyword">if</span>(dep[v]==dep[u]<span class="hljs-number">+1</span>&amp;&amp;e[i].f)&#123;<br>            <span class="hljs-type">int</span> t=<span class="hljs-built_in">find</span>(v,<span class="hljs-built_in">min</span>(e[i].f,limit-flow));<br>            <span class="hljs-keyword">if</span>(!t) dep[v]=<span class="hljs-number">-1</span>;<br>            flow+=t;<br>            e[i].f-=t;e[i^<span class="hljs-number">1</span>].f+=t;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> flow;<br>&#125;<br><span class="hljs-type">int</span> sum;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;m&gt;&gt;n;<br>    s=n+m<span class="hljs-number">+1</span>,t=n+m<span class="hljs-number">+2</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>,r;i&lt;=m;i++)&#123;<br>        cin&gt;&gt;r;sum+=r;<br>        <span class="hljs-built_in">addedge</span>(s,i,r);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=m<span class="hljs-number">+1</span>;j&lt;=n+m;j++)&#123;<br>            <span class="hljs-built_in">addedge</span>(i,j,<span class="hljs-number">1</span>);<br>        &#125;        <br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=m<span class="hljs-number">+1</span>,c;i&lt;=n+m;i++)&#123;<br>        cin&gt;&gt;c;<br>        <span class="hljs-built_in">addedge</span>(i,t,c);<br>    &#125;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>())&#123;<br>        <span class="hljs-type">int</span> flow;<br>        <span class="hljs-keyword">while</span>(flow=<span class="hljs-built_in">find</span>(s,INF)) ans+=flow;<br>    &#125;<br>    cerr&lt;&lt;ans&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(ans!=sum)&#123;<br>        cout&lt;&lt;<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    cout&lt;&lt;<span class="hljs-string">&quot;1\n&quot;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=head[i];j;j=e[j].nxt)&#123;<br>            <span class="hljs-keyword">if</span>(e[j].to&gt;m&amp;&amp;e[j].f==<span class="hljs-number">0</span>) cout&lt;&lt;e[j].to-m&lt;&lt;<span class="hljs-string">&#x27; &#x27;</span>;<br>        &#125;<br>        cout&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>    &#125;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP2891">LuoguP2891</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">double</span> START=<span class="hljs-built_in">clock</span>();<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">50000</span>,INF=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> n,f,d,head[N],dep[N],cur[N],s,t,tot=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<br>    <span class="hljs-type">int</span> to,nxt,f;<br>&#125;e[N];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addedge</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c)</span></span>&#123;<br>    e[++tot]=&#123;v,head[u],c&#125;;<br>    head[u]=tot;<br>    e[++tot]=&#123;u,head[v],<span class="hljs-number">0</span>&#125;;<br>    head[v]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>    <span class="hljs-built_in">memset</span>(dep,<span class="hljs-number">-1</span>,<span class="hljs-built_in">sizeof</span>(dep));<br>    q.<span class="hljs-built_in">push</span>(s);dep[s]=<span class="hljs-number">0</span>;cur[s]=head[s];<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>        <span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>            <span class="hljs-type">int</span> v=e[i].to;<br>            <span class="hljs-keyword">if</span>(dep[v]==<span class="hljs-number">-1</span>&amp;&amp;e[i].f)&#123;<br>                dep[v]=dep[u]<span class="hljs-number">+1</span>;<br>                cur[v]=head[v];<br>                <span class="hljs-keyword">if</span>(v==t)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>                q.<span class="hljs-built_in">push</span>(v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> limit)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(u==t) <span class="hljs-keyword">return</span> limit;<br>    <span class="hljs-type">int</span> flow=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=cur[u];i&amp;&amp;flow&lt;limit;i=e[i].nxt)&#123;<br>        <span class="hljs-type">int</span> v=e[i].to;<br>        cur[u]=i;<br>        <span class="hljs-keyword">if</span>(dep[v]==dep[u]<span class="hljs-number">+1</span>&amp;&amp;e[i].f)&#123;<br>            <span class="hljs-type">int</span> t=<span class="hljs-built_in">find</span>(v,<span class="hljs-built_in">min</span>(e[i].f,limit-flow));<br>            <span class="hljs-keyword">if</span>(!t) dep[v]=<span class="hljs-number">-1</span>;<br>            e[i].f-=t,e[i^<span class="hljs-number">1</span>].f+=t;<br>            flow+=t;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> flow;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin&gt;&gt;n&gt;&gt;f&gt;&gt;d;<br>    s=f+n+n+d<span class="hljs-number">+1</span>,t=s<span class="hljs-number">+1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=f;i++) <span class="hljs-built_in">addedge</span>(s,i,<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=f+n+n<span class="hljs-number">+1</span>;i&lt;s;i++) <span class="hljs-built_in">addedge</span>(i,t,<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=f<span class="hljs-number">+1</span>;i&lt;=f+n;i++) <span class="hljs-built_in">addedge</span>(i,i+n,<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>,ff,dd,x;i&lt;=n;i++)&#123;<br>        cin&gt;&gt;ff&gt;&gt;dd;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=ff;j++)&#123;<br>            cin&gt;&gt;x;<br>            <span class="hljs-built_in">addedge</span>(x,i+f,<span class="hljs-number">1</span>);<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=dd;j++)&#123;<br>            cin&gt;&gt;x;<br>            <span class="hljs-built_in">addedge</span>(i+f+n,x+f+n+n,<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">int</span> r=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>())&#123;<br>        <span class="hljs-type">int</span> flow;<br>        <span class="hljs-keyword">while</span>(flow=<span class="hljs-built_in">find</span>(s,INF)) r+=flow;<br>    &#125;<br>    cout&lt;&lt;r;<br>    cerr&lt;&lt;<span class="hljs-string">&quot;\nTime: &quot;</span>&lt;&lt;<span class="hljs-built_in">clock</span>()-START&lt;&lt;<span class="hljs-string">&quot;ms&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="POJ3204">POJ3204</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">510</span>,M=<span class="hljs-number">10010</span>,INF=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> n,m,s,t,dep[N],head[N],cur[N],tot=<span class="hljs-number">1</span>;<br><span class="hljs-type">bool</span> vis_s[N],<span class="hljs-type">vis_t</span>[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<br>	<span class="hljs-type">int</span> to,nxt,f;<br>&#125;e[M];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addedge</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c)</span></span>&#123;<br>	e[++tot]=&#123;v,head[u],c&#125;;<br>	head[u]=tot;<br>	e[++tot]=&#123;u,head[v],<span class="hljs-number">0</span>&#125;;<br>	head[v]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>&#123;<br>	queue&lt;<span class="hljs-type">int</span>&gt; q;<br>	<span class="hljs-built_in">memset</span>(dep,<span class="hljs-number">-1</span>,<span class="hljs-built_in">sizeof</span>(dep));<br>	q.<span class="hljs-built_in">push</span>(s);dep[s]=<span class="hljs-number">0</span>;cur[s]=head[s];<br>	<span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>		<span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>			<span class="hljs-type">int</span> v=e[i].to;<br>			<span class="hljs-keyword">if</span>(dep[v]==<span class="hljs-number">-1</span>&amp;&amp;e[i].f)&#123;<br>				dep[v]=dep[u]<span class="hljs-number">+1</span>;<br>				cur[v]=head[v];<br>				<span class="hljs-keyword">if</span>(v==t) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>				q.<span class="hljs-built_in">push</span>(v);<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> limit)</span></span>&#123;<br>	<span class="hljs-keyword">if</span>(u==t) <span class="hljs-keyword">return</span> limit;<br>	<span class="hljs-type">int</span> flow=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=cur[u];i&amp;&amp;flow&lt;limit;i=e[i].nxt)&#123;<br>		<span class="hljs-type">int</span> v=e[i].to;<br>		cur[u]=i;<br>		<span class="hljs-keyword">if</span>(dep[v]==dep[u]<span class="hljs-number">+1</span>&amp;&amp;e[i].f)&#123;<br>			<span class="hljs-type">int</span> t=<span class="hljs-built_in">find</span>(v,<span class="hljs-built_in">min</span>(e[i].f,limit-flow));<br>			<span class="hljs-keyword">if</span>(!t) dep[v]=<span class="hljs-number">-1</span>;<br>			e[i].f-=t;e[i^<span class="hljs-number">1</span>].f+=t;<br>			flow+=t;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> flow;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">bool</span> st[],<span class="hljs-type">bool</span> p)</span></span>&#123;<br>	st[u]=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>		<span class="hljs-type">int</span> j=i^p,v=e[i].to;<br>		<span class="hljs-keyword">if</span>(e[j].f&amp;&amp;!st[v]) <span class="hljs-built_in">dfs</span>(v,st,p);<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>	ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>	cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>	cin&gt;&gt;n&gt;&gt;m;<br>	s=<span class="hljs-number">1</span>,t=n;<br>	<span class="hljs-keyword">while</span>(m--)&#123;<br>		<span class="hljs-type">int</span> a,b,c;<br>		cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;<br>		<span class="hljs-built_in">addedge</span>(++a,++b,c);<br>	&#125;<br>	<span class="hljs-type">int</span> r=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>())&#123;<br>		<span class="hljs-type">int</span> flow;<br>		<span class="hljs-keyword">while</span>(flow=<span class="hljs-built_in">find</span>(s,INF)) r+=flow;<br>	&#125;<br>	<span class="hljs-built_in">dfs</span>(s,vis_s,<span class="hljs-number">0</span>);<br>	<span class="hljs-built_in">dfs</span>(t,<span class="hljs-type">vis_t</span>,<span class="hljs-number">1</span>);<br>	<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=tot;i+=<span class="hljs-number">2</span>)&#123;<br>		<span class="hljs-keyword">if</span>(!e[i].f&amp;&amp;vis_s[e[i^<span class="hljs-number">1</span>].to]&amp;&amp;<span class="hljs-type">vis_t</span>[e[i].to]) ans++;<br>	&#125;<br>	cout&lt;&lt;ans;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP2274">LuoguP2274</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> int long long</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">10010</span>,INF=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> S,T,n,m,head[N],cur[N],dep[N],tot=<span class="hljs-number">1</span>,sum;<br><span class="hljs-type">int</span> dx[]=&#123;<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>&#125;,dy[]=&#123;<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">0</span>&#125;;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<span class="hljs-type">int</span> to,nxt,f;&#125;e[<span class="hljs-number">100010</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">hsh</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span></span>&#123;<span class="hljs-keyword">return</span> (a<span class="hljs-number">-1</span>)*m+b;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c)</span></span>&#123;<br>    e[++tot]=&#123;v,head[u],c&#125;;head[u]=tot;<br>    e[++tot]=&#123;u,head[v],<span class="hljs-number">0</span>&#125;;head[v]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>    <span class="hljs-built_in">memset</span>(dep,<span class="hljs-number">-1</span>,<span class="hljs-built_in">sizeof</span>(dep));<br>    q.<span class="hljs-built_in">push</span>(S);dep[S]=<span class="hljs-number">0</span>;cur[S]=head[S];<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>        <span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>            <span class="hljs-type">int</span> v=e[i].to;<br>            <span class="hljs-keyword">if</span>(dep[v]==<span class="hljs-number">-1</span>&amp;&amp;e[i].f)&#123;<br>                cur[v]=head[v];dep[v]=dep[u]<span class="hljs-number">+1</span>;<br>                <span class="hljs-keyword">if</span>(v==T) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>                q.<span class="hljs-built_in">push</span>(v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> limit)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(u==T) <span class="hljs-keyword">return</span> limit;<br>    <span class="hljs-type">int</span> flow=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=cur[u];i&amp;&amp;flow&lt;limit;i=e[i].nxt)&#123;<br>        <span class="hljs-type">int</span> v=e[i].to;cur[u]=i;<br>        <span class="hljs-keyword">if</span>(dep[v]==dep[u]<span class="hljs-number">+1</span>&amp;&amp;e[i].f)&#123;<br>            <span class="hljs-type">int</span> t=<span class="hljs-built_in">find</span>(v,<span class="hljs-built_in">min</span>(e[i].f,limit-flow));<br>            <span class="hljs-keyword">if</span>(!t) dep[v]=<span class="hljs-number">-1</span>;<br>            e[i].f-=t;e[i^<span class="hljs-number">1</span>].f+=t;flow+=t;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> flow;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    cin&gt;&gt;n&gt;&gt;m;<br>    S=n*m<span class="hljs-number">+1</span>,T=S<span class="hljs-number">+1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++)&#123;<br>            <span class="hljs-type">int</span> x;<br>            cin&gt;&gt;x;sum+=x;<br>            <span class="hljs-keyword">if</span>(!((i+j)%<span class="hljs-number">2</span>))&#123;<br>                <span class="hljs-built_in">add</span>(S,<span class="hljs-built_in">hsh</span>(i,j),x);<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;k&lt;<span class="hljs-number">4</span>;k++)&#123;<br>                    <span class="hljs-type">int</span> tx=i+dx[k],ty=j+dy[k];<br>                    <span class="hljs-keyword">if</span>(tx==<span class="hljs-number">0</span>||ty==<span class="hljs-number">0</span>||tx&gt;n||ty&gt;m) <span class="hljs-keyword">continue</span>;<br>                    <span class="hljs-built_in">add</span>(<span class="hljs-built_in">hsh</span>(i,j),<span class="hljs-built_in">hsh</span>(tx,ty),INF);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(<span class="hljs-built_in">hsh</span>(i,j),T,x);<br><br>        &#125;<br>    &#125;<br>    <span class="hljs-type">int</span> r=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>())&#123;<br>        <span class="hljs-type">int</span> flow;<br>        <span class="hljs-keyword">while</span>(flow=<span class="hljs-built_in">find</span>(S,INF)) r+=flow;<br>    &#125;<br>    cout&lt;&lt;sum-r;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="BZOJ3275">BZOJ3275</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">3010</span>,INF=<span class="hljs-number">1e9</span>;<br><span class="hljs-type">int</span> n,a[N],head[N],cur[N],dep[N],tot=<span class="hljs-number">1</span>,S,T,sum;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<span class="hljs-type">int</span> to,nxt,f;&#125;e[<span class="hljs-number">50010</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c)</span></span>&#123;<br>    e[++tot]=&#123;v,head[u],c&#125;;head[u]=tot;<br>    e[++tot]=&#123;u,head[v],<span class="hljs-number">0</span>&#125;;head[v]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">gcd</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<span class="hljs-keyword">return</span> y==<span class="hljs-number">0</span>?x:<span class="hljs-built_in">gcd</span>(y,x%y);&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>    <span class="hljs-built_in">memset</span>(dep,<span class="hljs-number">-1</span>,<span class="hljs-built_in">sizeof</span>(dep));<br>    q.<span class="hljs-built_in">push</span>(S);dep[S]=<span class="hljs-number">0</span>;cur[S]=head[S];<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>        <span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>            <span class="hljs-type">int</span> v=e[i].to;<br>            <span class="hljs-keyword">if</span>(dep[v]==<span class="hljs-number">-1</span>&amp;&amp;e[i].f)&#123;<br>                dep[v]=dep[u]<span class="hljs-number">+1</span>;cur[v]=head[v];<br>                <span class="hljs-keyword">if</span>(v==T) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>                q.<span class="hljs-built_in">push</span>(v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> limit)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(u==T) <span class="hljs-keyword">return</span> limit;<br>    <span class="hljs-type">int</span> flow=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=cur[u];i&amp;&amp;flow&lt;limit;i=e[i].nxt)&#123;<br>        cur[u]=i;<span class="hljs-type">int</span> v=e[i].to;<br>        <span class="hljs-keyword">if</span>(dep[v]==dep[u]<span class="hljs-number">+1</span>&amp;&amp;e[i].f)&#123;<br>            <span class="hljs-type">int</span> t=<span class="hljs-built_in">find</span>(v,<span class="hljs-built_in">min</span>(e[i].f,limit-flow));<br>            <span class="hljs-keyword">if</span>(!t) dep[v]=<span class="hljs-number">-1</span>;<br>            e[i].f-=t;e[i^<span class="hljs-number">1</span>].f+=t;flow+=t;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> flow;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    cin&gt;&gt;n;<br>    S=n<span class="hljs-number">+1</span>,T=S<span class="hljs-number">+1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++) cin&gt;&gt;a[i];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        sum+=a[i];<br>        <span class="hljs-keyword">if</span>(a[i]%<span class="hljs-number">2</span>)&#123;<br>            <span class="hljs-built_in">add</span>(S,i,a[i]);<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=n;j++)&#123;<br>                <span class="hljs-type">int</span> k=<span class="hljs-built_in">sqrt</span>(a[i]*a[i]+a[j]*a[j]);<br>                <span class="hljs-keyword">if</span>(<span class="hljs-built_in">gcd</span>(a[i],a[j])==<span class="hljs-number">1</span>&amp;&amp;k*k==a[i]*a[i]+a[j]*a[j]) <span class="hljs-built_in">add</span>(i,j,INF);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-built_in">add</span>(i,T,a[i]);<br>    &#125;<br>    <span class="hljs-type">int</span> r=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">bfs</span>())&#123;<br>        <span class="hljs-type">int</span> flow;<br>        <span class="hljs-keyword">while</span>(flow=<span class="hljs-built_in">find</span>(S,INF)) r+=flow;<br>    &#125;<br>    cout&lt;&lt;sum-r;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4015">LuoguP4015</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">510</span>,INF=<span class="hljs-number">0x3f3f3f3f</span>;<br><span class="hljs-type">int</span> m,n,S,T,head[N],dis[N],incf[N],pre[N],tot=<span class="hljs-number">1</span>,cost;<br><span class="hljs-type">bool</span> vis[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<span class="hljs-type">int</span> to,nxt,f,w;&#125;e[<span class="hljs-number">50010</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c,<span class="hljs-type">int</span> w)</span></span>&#123;<br>    e[++tot]=&#123;v,head[u],c,w&#125;;head[u]=tot;<br>    e[++tot]=&#123;u,head[v],<span class="hljs-number">0</span>,-w&#125;;head[v]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">spfa</span><span class="hljs-params">()</span></span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>    <span class="hljs-built_in">memset</span>(vis,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(vis));<br>    <span class="hljs-built_in">memset</span>(dis,<span class="hljs-number">0x3f</span>,<span class="hljs-built_in">sizeof</span>(dis));<br>    q.<span class="hljs-built_in">push</span>(S);dis[S]=<span class="hljs-number">0</span>;vis[S]=<span class="hljs-number">1</span>;incf[S]=INF;<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>        <span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>        vis[u]=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>            <span class="hljs-type">int</span> v=e[i].to;<br>            <span class="hljs-keyword">if</span>(e[i].f&amp;&amp;dis[v]&gt;dis[u]+e[i].w)&#123;<br>                dis[v]=dis[u]+e[i].w;<br>                incf[v]=<span class="hljs-built_in">min</span>(incf[u],e[i].f);<br>                pre[v]=i;<br>                <span class="hljs-keyword">if</span>(!vis[v]) vis[v]=<span class="hljs-number">1</span>,q.<span class="hljs-built_in">push</span>(v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> dis[T]!=INF;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">EK</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">spfa</span>())&#123;<br>        cost+=dis[T]*incf[T];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=T;i!=S;i=e[pre[i]^<span class="hljs-number">1</span>].to)&#123;<br>            e[pre[i]].f-=incf[T];<br>            e[pre[i]^<span class="hljs-number">1</span>].f+=incf[T];<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    cin&gt;&gt;m&gt;&gt;n;<br>    S=m+n<span class="hljs-number">+1</span>,T=S<span class="hljs-number">+1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>,x;i&lt;=m;i++)&#123;<br>        cin&gt;&gt;x;<br>        <span class="hljs-built_in">add</span>(S,i,x,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>,x;i&lt;=n;i++)&#123;<br>        cin&gt;&gt;x;<br>        <span class="hljs-built_in">add</span>(i+m,T,x,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>,x;j&lt;=n;j++)&#123;<br>            cin&gt;&gt;x;<br>            <span class="hljs-built_in">add</span>(i,j+m,INF,x);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">EK</span>();<br>    cout&lt;&lt;cost&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=tot;i++)&#123;<br>        e[i].w*=<span class="hljs-number">-1</span>;<br>        <span class="hljs-keyword">if</span>(!(i%<span class="hljs-number">2</span>))e[i].f+=e[i^<span class="hljs-number">1</span>].f,e[i^<span class="hljs-number">1</span>].f=<span class="hljs-number">0</span>;<br>    &#125;<br>    cost=<span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">EK</span>();<br>    cout&lt;&lt;-cost;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="LuoguP4012">LuoguP4012</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">1e4</span><span class="hljs-number">+10</span>,M=<span class="hljs-number">1e5</span><span class="hljs-number">+10</span>,INF=<span class="hljs-number">0x3f3f3f3f</span>;<br><span class="hljs-type">int</span> a,b,p,q,id[N][N],tot_,tot=<span class="hljs-number">1</span>,pre[N],incf[N],dis[N],head[N],S,T;<br><span class="hljs-type">bool</span> vis[N];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Edge</span>&#123;<span class="hljs-type">int</span> to,nxt,f,w;&#125;e[M];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> u,<span class="hljs-type">int</span> v,<span class="hljs-type">int</span> c,<span class="hljs-type">int</span> w)</span></span>&#123;<br>    e[++tot]=&#123;v,head[u],c,-w&#125;;head[u]=tot;<br>    e[++tot]=&#123;u,head[v],<span class="hljs-number">0</span>,w&#125;;head[v]=tot;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">spfa</span><span class="hljs-params">()</span></span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;q.<span class="hljs-built_in">push</span>(S);<br>    <span class="hljs-built_in">memset</span>(dis,<span class="hljs-number">0x3f</span>,<span class="hljs-built_in">sizeof</span>(dis));<br>    <span class="hljs-built_in">memset</span>(vis,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(vis));<br>    dis[S]=<span class="hljs-number">0</span>;vis[S]=<span class="hljs-number">1</span>;incf[S]=INF;<br>    <span class="hljs-keyword">while</span>(q.<span class="hljs-built_in">size</span>())&#123;<br>        <span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>();q.<span class="hljs-built_in">pop</span>();<br>        vis[u]=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=head[u];i;i=e[i].nxt)&#123;<br>            <span class="hljs-type">int</span> v=e[i].to;<br>            <span class="hljs-keyword">if</span>(e[i].f&amp;&amp;dis[v]&gt;dis[u]+e[i].w)&#123;<br>                dis[v]=dis[u]+e[i].w;<br>                incf[v]=<span class="hljs-built_in">min</span>(incf[u],e[i].f);<br>                pre[v]=i;<br>                <span class="hljs-keyword">if</span>(!vis[v]) vis[v]=<span class="hljs-number">1</span>,q.<span class="hljs-built_in">push</span>(v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> dis[T]!=INF;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">EK</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> cost=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">spfa</span>())&#123;<br>        cost+=dis[T]*incf[T];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=T;i!=S;i=e[pre[i]^<span class="hljs-number">1</span>].to)&#123;<br>            e[pre[i]].f-=incf[T];<br>            e[pre[i]^<span class="hljs-number">1</span>].f+=incf[T];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> cost;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    S=++tot_;T=++tot_;<br>    cin&gt;&gt;a&gt;&gt;b&gt;&gt;p&gt;&gt;q;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=p<span class="hljs-number">+1</span>;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;=q<span class="hljs-number">+1</span>;j++)&#123;<br>            id[i][j]=++tot_;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=p;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>,x;j&lt;q;j++)&#123;<br>            cin&gt;&gt;x;<br>            <span class="hljs-built_in">add</span>(id[i][j],id[i][j<span class="hljs-number">+1</span>],<span class="hljs-number">1</span>,x);<br>            <span class="hljs-built_in">add</span>(id[i][j],id[i][j<span class="hljs-number">+1</span>],INF,<span class="hljs-number">0</span>);<br><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=q;i++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>,x;j&lt;p;j++)&#123;<br>            cin&gt;&gt;x;<br>            <span class="hljs-built_in">add</span>(id[j][i],id[j<span class="hljs-number">+1</span>][i],<span class="hljs-number">1</span>,x);<br>            <span class="hljs-built_in">add</span>(id[j][i],id[j<span class="hljs-number">+1</span>][i],INF,<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">while</span>(a--)&#123;<br>        <span class="hljs-type">int</span> k,y,x;<br>        cin&gt;&gt;k&gt;&gt;x&gt;&gt;y;<br>        <span class="hljs-built_in">add</span>(S,id[x][y],k,<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">while</span>(b--)&#123;<br>        <span class="hljs-type">int</span> k,y,x;<br>        cin&gt;&gt;k&gt;&gt;x&gt;&gt;y;<br>        <span class="hljs-built_in">add</span>(id[x][y],T,k,<span class="hljs-number">0</span>);<br>    &#125;<br>    cout&lt;&lt;-<span class="hljs-built_in">EK</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>标程</div>
      <div>https://yumomeow.github.io/2025/02/24/std/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>雨沫</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年2月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'YumoMeow/blog-comment');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'Comment');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener" style="color: white"><span>Hexo</span></a> <i class="iconfont icon-love" style="color: white"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener" style="color: white"><span>Fluid</span></a> <!-- 博客上线天数 --> <div> <span id="timeDate" style="color: white">载入天数...</span> <span id="times" style="color: white">载入时分秒...</span> <script src="/js/duration.js"></script> </div> <a href="https://icp.gov.moe/?keyword=20251185" target="_blank" style="color: white">萌ICP备20251185号</a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/title.js"></script>
<script src="/js/color.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<!-- hexo injector body_end start --><script src="/js/backgroundize.js"></script><!-- hexo injector body_end end --></body>
</html>
